2025-09-16 03:19:58,655 - INFO - Initialized OpenAI client
2025-09-16 03:20:01,561 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-09-16 03:20:01,564 - ERROR - Error generating parser code: Error code: 404 - {'error': {'message': 'The model `gpt-4` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2025-09-16 03:20:03,489 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-09-16 03:20:03,491 - ERROR - Error generating parser code: Error code: 404 - {'error': {'message': 'The model `gpt-4` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2025-09-16 03:20:08,257 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 404 Not Found"
2025-09-16 03:20:08,267 - ERROR - Error generating parser code: Error code: 404 - {'error': {'message': 'The model `gpt-4` does not exist or you do not have access to it.', 'type': 'invalid_request_error', 'param': None, 'code': 'model_not_found'}}
2025-09-16 03:21:47,725 - INFO - Initialized OpenAI client
2025-09-16 03:21:47,726 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 03:21:47,727 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 03:21:47,727 - INFO - [GENERATE] Generating parser code...
2025-09-16 03:21:50,803 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 03:21:50,804 - INFO - Retrying request to /chat/completions in 0.379569 seconds
2025-09-16 03:21:52,604 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 03:21:52,605 - INFO - Retrying request to /chat/completions in 0.923027 seconds
2025-09-16 03:21:54,848 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 03:21:54,851 - ERROR - Error generating parser code: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-09-16 03:21:54,852 - ERROR - [ERROR] Error in attempt 1: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-09-16 03:21:54,853 - INFO - [RETRY] Retrying...
2025-09-16 03:21:54,853 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 03:21:54,854 - INFO - [GENERATE] Generating parser code...
2025-09-16 03:21:56,291 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 03:21:56,293 - INFO - Retrying request to /chat/completions in 0.454775 seconds
2025-09-16 03:21:57,248 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 03:21:57,249 - INFO - Retrying request to /chat/completions in 0.790330 seconds
2025-09-16 03:21:59,220 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 03:21:59,222 - ERROR - Error generating parser code: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-09-16 03:21:59,223 - ERROR - [ERROR] Error in attempt 2: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-09-16 03:21:59,223 - INFO - [RETRY] Retrying...
2025-09-16 03:21:59,224 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 03:21:59,224 - INFO - [GENERATE] Generating parser code...
2025-09-16 03:21:59,622 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 03:21:59,623 - INFO - Retrying request to /chat/completions in 0.480191 seconds
2025-09-16 03:22:01,408 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 03:22:01,410 - INFO - Retrying request to /chat/completions in 0.981708 seconds
2025-09-16 03:22:02,743 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 03:22:02,744 - ERROR - Error generating parser code: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-09-16 03:22:02,745 - ERROR - [ERROR] Error in attempt 3: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-09-16 03:22:02,746 - ERROR - [FAILED] Failed after 3 attempts due to errors
2025-09-16 03:22:02,747 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 10:59:21,838 - INFO - Initialized OpenAI client
2025-09-16 10:59:21,839 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 10:59:21,839 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 10:59:21,839 - INFO - [GENERATE] Generating parser code...
2025-09-16 10:59:22,899 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 10:59:22,899 - INFO - Retrying request to /chat/completions in 0.461061 seconds
2025-09-16 10:59:24,231 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 10:59:24,232 - INFO - Retrying request to /chat/completions in 0.977286 seconds
2025-09-16 10:59:26,174 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 10:59:26,182 - ERROR - Error generating parser code: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-09-16 10:59:26,182 - ERROR - [ERROR] Error in attempt 1: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-09-16 10:59:26,182 - INFO - [RETRY] Retrying...
2025-09-16 10:59:26,184 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 10:59:26,184 - INFO - [GENERATE] Generating parser code...
2025-09-16 10:59:26,892 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 10:59:26,894 - INFO - Retrying request to /chat/completions in 0.402607 seconds
2025-09-16 10:59:27,908 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 10:59:27,910 - INFO - Retrying request to /chat/completions in 0.827567 seconds
2025-09-16 10:59:29,100 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 10:59:29,103 - ERROR - Error generating parser code: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-09-16 10:59:29,103 - ERROR - [ERROR] Error in attempt 2: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-09-16 10:59:29,104 - INFO - [RETRY] Retrying...
2025-09-16 10:59:29,104 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 10:59:29,104 - INFO - [GENERATE] Generating parser code...
2025-09-16 10:59:29,455 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 10:59:29,457 - INFO - Retrying request to /chat/completions in 0.401047 seconds
2025-09-16 10:59:30,519 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 10:59:30,520 - INFO - Retrying request to /chat/completions in 0.810589 seconds
2025-09-16 10:59:31,717 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-09-16 10:59:31,718 - ERROR - Error generating parser code: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-09-16 10:59:31,720 - ERROR - [ERROR] Error in attempt 3: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
2025-09-16 10:59:31,720 - ERROR - [FAILED] Failed after 3 attempts due to errors
2025-09-16 10:59:31,720 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 11:28:22,301 - INFO - Initialized Gemini client
2025-09-16 11:28:22,302 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 11:28:22,302 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 11:28:22,302 - INFO - [GENERATE] Generating parser code...
2025-09-16 11:28:24,166 - ERROR - Error generating parser code: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-09-16 11:28:24,166 - ERROR - [ERROR] Error in attempt 1: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-09-16 11:28:24,166 - INFO - [RETRY] Retrying...
2025-09-16 11:28:24,166 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 11:28:24,166 - INFO - [GENERATE] Generating parser code...
2025-09-16 11:28:24,726 - ERROR - Error generating parser code: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-09-16 11:28:24,726 - ERROR - [ERROR] Error in attempt 2: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-09-16 11:28:24,727 - INFO - [RETRY] Retrying...
2025-09-16 11:28:24,727 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 11:28:24,727 - INFO - [GENERATE] Generating parser code...
2025-09-16 11:28:25,649 - ERROR - Error generating parser code: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-09-16 11:28:25,650 - ERROR - [ERROR] Error in attempt 3: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-09-16 11:28:25,650 - ERROR - [FAILED] Failed after 3 attempts due to errors
2025-09-16 11:28:25,650 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 11:49:25,522 - INFO - Initialized Gemini client
2025-09-16 11:49:25,522 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 11:49:25,522 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 11:49:25,522 - INFO - [GENERATE] Generating parser code...
2025-09-16 11:49:26,300 - ERROR - Error generating parser code: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-09-16 11:49:26,300 - ERROR - [ERROR] Error in attempt 1: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-09-16 11:49:26,300 - INFO - [RETRY] Retrying...
2025-09-16 11:49:26,300 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 11:49:26,300 - INFO - [GENERATE] Generating parser code...
2025-09-16 11:49:27,527 - ERROR - Error generating parser code: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-09-16 11:49:27,527 - ERROR - [ERROR] Error in attempt 2: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-09-16 11:49:27,527 - INFO - [RETRY] Retrying...
2025-09-16 11:49:27,528 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 11:49:27,528 - INFO - [GENERATE] Generating parser code...
2025-09-16 11:49:27,937 - ERROR - Error generating parser code: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-09-16 11:49:27,937 - ERROR - [ERROR] Error in attempt 3: 400 API key not valid. Please pass a valid API key. [reason: "API_KEY_INVALID"
domain: "googleapis.com"
metadata {
  key: "service"
  value: "generativelanguage.googleapis.com"
}
, locale: "en-US"
message: "API key not valid. Please pass a valid API key."
]
2025-09-16 11:49:27,938 - ERROR - [FAILED] Failed after 3 attempts due to errors
2025-09-16 11:49:27,938 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 13:07:54,692 - INFO - Initialized Gemini client
2025-09-16 13:07:54,693 - INFO - [START] Starting agent loop for ICICI. bank
2025-09-16 13:07:54,693 - ERROR - Sample PDF not found: data\icici.\icici. sample.pdf
2025-09-16 13:07:54,694 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 13:09:51,181 - INFO - Initialized Gemini client
2025-09-16 13:09:51,182 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 13:09:51,182 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 13:09:51,182 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:09:55,753 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:09:55,755 - INFO - [TEST] Running tests...
2025-09-16 13:09:59,622 - ERROR - [FAIL] Tests failed!
2025-09-16 13:09:59,623 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (1, 5), expected (100, 5)
E   assert (1, 5) == (100, 5)
E     
E     At index 0 diff: 1 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?      --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (1, 5), expected (100, 5)\nassert (1, 5) == (100, 5)\n  \n  At index 0 diff: 1 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?      --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (1, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\n        Date               Description    Debit   Credit  Balance\n0 2025-01-27  Fuel Purchase Debit Card  1533.65  4047.68      0.0\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.06s =========================

2025-09-16 13:09:59,624 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (1, 5), expected (100, 5)
E   assert (1, 5) == (100, 5)
E     
E     At index 0 diff: 1 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?      --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (1, 5), expected (100, 5)\nassert (1, 5) == (100, 5)\n  \n  At index 0 diff: 1 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?      --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (1, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\n        Date               Description    Debit   Credit  Balance\n0 2025-01-27  Fuel Purchase Debit Card  1533.65  4047.68      0.0\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.06s =========================

2025-09-16 13:09:59,625 - INFO - [RETRY] Retrying with improved code...
2025-09-16 13:09:59,625 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 13:09:59,625 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:10:04,448 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:10:04,449 - INFO - [TEST] Running tests...
2025-09-16 13:10:08,473 - ERROR - [FAIL] Tests failed!
2025-09-16 13:10:08,473 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (91, 5), expected (100, 5)
E   assert (91, 5) == (100, 5)
E     
E     At index 0 diff: 91 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?      --...
E     
E     ...Full output truncated (4 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (91, 5), expected (100, 5)\nassert (91, 5) == (100, 5)\n  \n  At index 0 diff: 91 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?      --...\n  \n  ...Full output truncated (4 lines hidden), use '-vv' to show\nResult DataFrame shape: (91, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\n        Date                Description    Debit    Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30   6864.58   4929.28\n1 2024-08-02  Salary Credit XYZ Pvt Ltd  1652.61   8517.19  11793.86\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08   4631.11  12538.89\n3 2024-08-03    Mobile Recharge Via UPI  1648.72   6279.83  17170.00\n4 2024-08-14   Fuel Purchase Debit Card  3878.57  10158.40  23449.83\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.25s =========================

2025-09-16 13:10:08,474 - WARNING - [FAILED] Attempt 2 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (91, 5), expected (100, 5)
E   assert (91, 5) == (100, 5)
E     
E     At index 0 diff: 91 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?      --...
E     
E     ...Full output truncated (4 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (91, 5), expected (100, 5)\nassert (91, 5) == (100, 5)\n  \n  At index 0 diff: 91 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?      --...\n  \n  ...Full output truncated (4 lines hidden), use '-vv' to show\nResult DataFrame shape: (91, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\n        Date                Description    Debit    Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30   6864.58   4929.28\n1 2024-08-02  Salary Credit XYZ Pvt Ltd  1652.61   8517.19  11793.86\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08   4631.11  12538.89\n3 2024-08-03    Mobile Recharge Via UPI  1648.72   6279.83  17170.00\n4 2024-08-14   Fuel Purchase Debit Card  3878.57  10158.40  23449.83\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.25s =========================

2025-09-16 13:10:08,474 - INFO - [RETRY] Retrying with improved code...
2025-09-16 13:10:08,475 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 13:10:08,475 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:10:13,873 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:10:13,874 - INFO - [TEST] Running tests...
2025-09-16 13:10:17,765 - ERROR - [FAIL] Tests failed!
2025-09-16 13:10:17,765 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (25, 5), expected (100, 5)
E   assert (25, 5) == (100, 5)
E     
E     At index 0 diff: 25 != 100
E     
E     Full diff:
E       (
E     -     100,
E     +     25,
E           5,
E       )
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (25, 5), expected (100, 5)\nassert (25, 5) == (100, 5)\n  \n  At index 0 diff: 25 != 100\n  \n  Full diff:\n    (\n  -     100,\n  +     25,\n        5,\n    )\nResult DataFrame shape: (25, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\n        Date                     Description  Debit  Credit  Balance\n0 2024-08-18  Interest Credit Saving Account    0.0  596.72   596.72\n1 2024-08-25   Cheque Deposit Local Clearing    0.0  617.86  1214.58\n2 2024-09-01           Dining Out Card Swipe    0.0  656.42  1871.00\n3 2024-09-12   Cheque Deposit Local Clearing    0.0  826.71  2697.71\n4 2024-09-26         IMPS UPI Payment Amazon    0.0  740.64  3438.35\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.06s =========================

2025-09-16 13:10:17,767 - WARNING - [FAILED] Attempt 3 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (25, 5), expected (100, 5)
E   assert (25, 5) == (100, 5)
E     
E     At index 0 diff: 25 != 100
E     
E     Full diff:
E       (
E     -     100,
E     +     25,
E           5,
E       )
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (25, 5), expected (100, 5)\nassert (25, 5) == (100, 5)\n  \n  At index 0 diff: 25 != 100\n  \n  Full diff:\n    (\n  -     100,\n  +     25,\n        5,\n    )\nResult DataFrame shape: (25, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\n        Date                     Description  Debit  Credit  Balance\n0 2024-08-18  Interest Credit Saving Account    0.0  596.72   596.72\n1 2024-08-25   Cheque Deposit Local Clearing    0.0  617.86  1214.58\n2 2024-09-01           Dining Out Card Swipe    0.0  656.42  1871.00\n3 2024-09-12   Cheque Deposit Local Clearing    0.0  826.71  2697.71\n4 2024-09-26         IMPS UPI Payment Amazon    0.0  740.64  3438.35\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.06s =========================

2025-09-16 13:10:17,767 - ERROR - [FAILED] Failed after 3 attempts
2025-09-16 13:10:17,767 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 13:12:50,156 - INFO - Initialized Gemini client
2025-09-16 13:12:50,157 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 13:12:50,474 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 13:12:50,475 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:12:58,952 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:12:58,953 - INFO - [TEST] Running tests...
2025-09-16 13:13:02,461 - ERROR - [FAIL] Tests failed!
2025-09-16 13:13:02,461 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:69: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    balance = float(balance.replace(",", ""))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:77: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    balance = float(balance.replace(",", ""))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:91: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    balance = float(balance.replace(",", ""))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:105: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    balance = float(balance.replace(",", ""))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 1.86s =========================

2025-09-16 13:13:02,462 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:69: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    balance = float(balance.replace(",", ""))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:77: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    balance = float(balance.replace(",", ""))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:91: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    balance = float(balance.replace(",", ""))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:105: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    balance = float(balance.replace(",", ""))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 1.86s =========================

2025-09-16 13:13:02,462 - INFO - [RETRY] Retrying with improved code...
2025-09-16 13:13:02,462 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 13:13:02,463 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:13:07,439 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:13:07,444 - INFO - [TEST] Running tests...
2025-09-16 13:13:11,748 - ERROR - [FAIL] Tests failed!
2025-09-16 13:13:11,748 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:69: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: '-'
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:77: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: '-'
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:91: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: '-'
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:105: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: '-'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 2.68s =========================

2025-09-16 13:13:11,749 - WARNING - [FAILED] Attempt 2 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:69: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: '-'
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:77: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: '-'
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:91: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: '-'
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:105: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: '-'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 2.68s =========================

2025-09-16 13:13:11,750 - INFO - [RETRY] Retrying with improved code...
2025-09-16 13:13:11,751 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 13:13:11,751 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:13:16,235 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:13:16,235 - INFO - [TEST] Running tests...
2025-09-16 13:13:20,460 - ERROR - [FAIL] Tests failed!
2025-09-16 13:13:20,461 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:69: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:32: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: 'Karbon'
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:77: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:32: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: 'Karbon'
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:91: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:32: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: 'Karbon'
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:105: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:32: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: 'Karbon'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 2.65s =========================

2025-09-16 13:13:20,463 - WARNING - [FAILED] Attempt 3 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:69: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:32: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: 'Karbon'
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:77: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:32: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: 'Karbon'
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:91: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:32: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: 'Karbon'
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:105: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:32: in parse
    df[col] = df[col].astype(str).str.replace(',', '', regex=False).replace('', '0.0').astype(float)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\generic.py:6643: in astype
    new_data = self._mgr.astype(dtype=dtype, copy=copy, errors=errors)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:430: in astype
    return self.apply(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\managers.py:363: in apply
    applied = getattr(b, f)(**kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\internals\blocks.py:758: in astype
    new_values = astype_array_safe(values, dtype, copy=copy, errors=errors)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:237: in astype_array_safe
    new_values = astype_array(values, dtype, copy=copy)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:182: in astype_array
    values = _astype_nansafe(values, dtype, copy=copy)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\dtypes\astype.py:133: in _astype_nansafe
    return arr.astype(dtype, copy=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: 'Karbon'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 2.65s =========================

2025-09-16 13:13:20,464 - ERROR - [FAILED] Failed after 3 attempts
2025-09-16 13:13:20,464 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 13:15:15,366 - INFO - Initialized Gemini client
2025-09-16 13:15:15,367 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 13:15:15,682 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 13:15:15,683 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:15:19,490 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:15:19,492 - INFO - [TEST] Running tests...
2025-09-16 13:15:23,301 - ERROR - [FAIL] Tests failed!
2025-09-16 13:15:23,302 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:84: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:94: in test_parse_data_types
    assert pd.api.types.is_datetime64_any_dtype(result['Date']), "Date column should be datetime type"
E   AssertionError: Date column should be datetime type
E   assert False
E    +  where False = <function is_datetime64_any_dtype at 0x000001BF346DAC00>(Series([], Name: Date, dtype: object))
E    +    where <function is_datetime64_any_dtype at 0x000001BF346DAC00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_datetime64_any_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (0, 5), expected (100, 5)
E   assert (0, 5) == (100, 5)
E     
E     At index 0 diff: 0 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?     --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (0, 5), expected (100, 5)\nassert (0, 5) == (100, 5)\n  \n  At index 0 diff: 0 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?     --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:8: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:158: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:12: in parse
    except pdfplumber.pdf.PLUMBER_EXCEPTION:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'PLUMBER_EXCEPTION'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 4 failed, 3 passed in 2.06s =========================

2025-09-16 13:15:23,302 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:84: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:94: in test_parse_data_types
    assert pd.api.types.is_datetime64_any_dtype(result['Date']), "Date column should be datetime type"
E   AssertionError: Date column should be datetime type
E   assert False
E    +  where False = <function is_datetime64_any_dtype at 0x000001BF346DAC00>(Series([], Name: Date, dtype: object))
E    +    where <function is_datetime64_any_dtype at 0x000001BF346DAC00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_datetime64_any_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (0, 5), expected (100, 5)
E   assert (0, 5) == (100, 5)
E     
E     At index 0 diff: 0 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?     --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (0, 5), expected (100, 5)\nassert (0, 5) == (100, 5)\n  \n  At index 0 diff: 0 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?     --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:8: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:158: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:12: in parse
    except pdfplumber.pdf.PLUMBER_EXCEPTION:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'PLUMBER_EXCEPTION'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 4 failed, 3 passed in 2.06s =========================

2025-09-16 13:15:23,303 - INFO - [RETRY] Retrying with improved code...
2025-09-16 13:15:23,304 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 13:15:23,304 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:15:28,167 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:15:28,168 - INFO - [TEST] Running tests...
2025-09-16 13:15:31,983 - ERROR - [FAIL] Tests failed!
2025-09-16 13:15:31,984 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:130: in test_parse_matches_expected_data
    assert result_row[col] == expected_row[col], \
E   AssertionError: Row 0, Column Debit: got 193.0, expected 1935.3
E   assert 193.0 == 1935.3
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Row 0, Column Debit: got 193.0, expected 1935.3\nassert 193.0 == 1935.3\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\n        Date                Description  Debit  Credit  Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  193.0    5.30    686.0\n1 2024-08-02  Salary Credit XYZ Pvt Ltd  165.0    2.61    851.0\n2 2024-08-03    IMPS UPI Payment Amazon  388.0    6.08    463.0\n3 2024-08-03    Mobile Recharge Via UPI  164.0    8.72    627.0\n4 2024-08-14   Fuel Purchase Debit Card  387.0    8.57    101.0\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.05s =========================

2025-09-16 13:15:31,984 - WARNING - [FAILED] Attempt 2 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:130: in test_parse_matches_expected_data
    assert result_row[col] == expected_row[col], \
E   AssertionError: Row 0, Column Debit: got 193.0, expected 1935.3
E   assert 193.0 == 1935.3
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Row 0, Column Debit: got 193.0, expected 1935.3\nassert 193.0 == 1935.3\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\n        Date                Description  Debit  Credit  Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  193.0    5.30    686.0\n1 2024-08-02  Salary Credit XYZ Pvt Ltd  165.0    2.61    851.0\n2 2024-08-03    IMPS UPI Payment Amazon  388.0    6.08    463.0\n3 2024-08-03    Mobile Recharge Via UPI  164.0    8.72    627.0\n4 2024-08-14   Fuel Purchase Debit Card  387.0    8.57    101.0\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.05s =========================

2025-09-16 13:15:31,985 - INFO - [RETRY] Retrying with improved code...
2025-09-16 13:15:31,985 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 13:15:31,985 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:15:39,806 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:15:39,807 - INFO - [TEST] Running tests...
2025-09-16 13:15:44,061 - ERROR - [FAIL] Tests failed!
2025-09-16 13:15:44,062 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:130: in test_parse_matches_expected_data
    assert result_row[col] == expected_row[col], \
E   AssertionError: Row 0, Column Debit: got 193.0, expected 1935.3
E   assert 193.0 == 1935.3
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Row 0, Column Debit: got 193.0, expected 1935.3\nassert 193.0 == 1935.3\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\n        Date                Description  Debit  Credit  Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  193.0    5.30    686.0\n1 2024-08-02  Salary Credit XYZ Pvt Ltd  165.0    2.61    851.0\n2 2024-08-03    IMPS UPI Payment Amazon  388.0    6.08    463.0\n3 2024-08-03    Mobile Recharge Via UPI  164.0    8.72    627.0\n4 2024-08-14   Fuel Purchase Debit Card  387.0    8.57    101.0\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:8: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:158: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:12: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 2 failed, 5 passed in 2.29s =========================

2025-09-16 13:15:44,063 - WARNING - [FAILED] Attempt 3 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:130: in test_parse_matches_expected_data
    assert result_row[col] == expected_row[col], \
E   AssertionError: Row 0, Column Debit: got 193.0, expected 1935.3
E   assert 193.0 == 1935.3
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Row 0, Column Debit: got 193.0, expected 1935.3\nassert 193.0 == 1935.3\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\n        Date                Description  Debit  Credit  Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  193.0    5.30    686.0\n1 2024-08-02  Salary Credit XYZ Pvt Ltd  165.0    2.61    851.0\n2 2024-08-03    IMPS UPI Payment Amazon  388.0    6.08    463.0\n3 2024-08-03    Mobile Recharge Via UPI  164.0    8.72    627.0\n4 2024-08-14   Fuel Purchase Debit Card  387.0    8.57    101.0\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:8: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:158: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:12: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 2 failed, 5 passed in 2.29s =========================

2025-09-16 13:15:44,063 - ERROR - [FAILED] Failed after 3 attempts
2025-09-16 13:15:44,063 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 13:18:45,974 - INFO - Initialized Gemini client
2025-09-16 13:18:45,975 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 13:18:46,297 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 13:18:46,297 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:18:49,967 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:18:49,968 - INFO - [TEST] Running tests...
2025-09-16 13:18:53,890 - ERROR - [FAIL] Tests failed!
2025-09-16 13:18:53,890 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:84: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:94: in test_parse_data_types
    assert pd.api.types.is_datetime64_any_dtype(result['Date']), "Date column should be datetime type"
E   AssertionError: Date column should be datetime type
E   assert False
E    +  where False = <function is_datetime64_any_dtype at 0x000001C2EABEAC00>(Series([], Name: Date, dtype: object))
E    +    where <function is_datetime64_any_dtype at 0x000001C2EABEAC00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_datetime64_any_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (0, 5), expected (100, 5)
E   assert (0, 5) == (100, 5)
E     
E     At index 0 diff: 0 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?     --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (0, 5), expected (100, 5)\nassert (0, 5) == (100, 5)\n  \n  At index 0 diff: 0 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?     --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 2.14s =========================

2025-09-16 13:18:53,891 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:84: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:94: in test_parse_data_types
    assert pd.api.types.is_datetime64_any_dtype(result['Date']), "Date column should be datetime type"
E   AssertionError: Date column should be datetime type
E   assert False
E    +  where False = <function is_datetime64_any_dtype at 0x000001C2EABEAC00>(Series([], Name: Date, dtype: object))
E    +    where <function is_datetime64_any_dtype at 0x000001C2EABEAC00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_datetime64_any_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (0, 5), expected (100, 5)
E   assert (0, 5) == (100, 5)
E     
E     At index 0 diff: 0 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?     --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (0, 5), expected (100, 5)\nassert (0, 5) == (100, 5)\n  \n  At index 0 diff: 0 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?     --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 2.14s =========================

2025-09-16 13:18:53,892 - INFO - [RETRY] Retrying with improved code...
2025-09-16 13:18:53,892 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 13:18:53,892 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:18:58,773 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:18:58,774 - INFO - [TEST] Running tests...
2025-09-16 13:19:02,919 - ERROR - [FAIL] Tests failed!
2025-09-16 13:19:02,920 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:84: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:98: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000001E97353AF20>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000001E97353AF20> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (0, 5), expected (100, 5)
E   assert (0, 5) == (100, 5)
E     
E     At index 0 diff: 0 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?     --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (0, 5), expected (100, 5)\nassert (0, 5) == (100, 5)\n  \n  At index 0 diff: 0 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?     --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
============================== warnings summary ===============================
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
  C:\Users\Vaishnav A\ai-agent-challenge\custom_parser\icici_parser.py:26: FutureWarning: DataFrame.applymap has been deprecated. Use DataFrame.map instead.
    df[numeric_cols] = df[numeric_cols].applymap(lambda x: float(x.replace(',', '')) if isinstance(x, str) and x else 0.0)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
=================== 3 failed, 4 passed, 4 warnings in 2.26s ===================

2025-09-16 13:19:02,920 - WARNING - [FAILED] Attempt 2 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:84: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:98: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000001E97353AF20>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000001E97353AF20> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (0, 5), expected (100, 5)
E   assert (0, 5) == (100, 5)
E     
E     At index 0 diff: 0 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?     --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (0, 5), expected (100, 5)\nassert (0, 5) == (100, 5)\n  \n  At index 0 diff: 0 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?     --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
============================== warnings summary ===============================
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
  C:\Users\Vaishnav A\ai-agent-challenge\custom_parser\icici_parser.py:26: FutureWarning: DataFrame.applymap has been deprecated. Use DataFrame.map instead.
    df[numeric_cols] = df[numeric_cols].applymap(lambda x: float(x.replace(',', '')) if isinstance(x, str) and x else 0.0)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
=================== 3 failed, 4 passed, 4 warnings in 2.26s ===================

2025-09-16 13:19:02,921 - INFO - [RETRY] Retrying with improved code...
2025-09-16 13:19:02,921 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 13:19:02,921 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:19:07,064 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:19:07,070 - INFO - [TEST] Running tests...
2025-09-16 13:19:11,073 - ERROR - [FAIL] Tests failed!
2025-09-16 13:19:11,074 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:84: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:94: in test_parse_data_types
    assert pd.api.types.is_datetime64_any_dtype(result['Date']), "Date column should be datetime type"
E   AssertionError: Date column should be datetime type
E   assert False
E    +  where False = <function is_datetime64_any_dtype at 0x000002CAC607AC00>(Series([], Name: Date, dtype: object))
E    +    where <function is_datetime64_any_dtype at 0x000002CAC607AC00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_datetime64_any_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (0, 5), expected (100, 5)
E   assert (0, 5) == (100, 5)
E     
E     At index 0 diff: 0 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?     --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (0, 5), expected (100, 5)\nassert (0, 5) == (100, 5)\n  \n  At index 0 diff: 0 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?     --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 2.26s =========================

2025-09-16 13:19:11,074 - WARNING - [FAILED] Attempt 3 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:84: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:94: in test_parse_data_types
    assert pd.api.types.is_datetime64_any_dtype(result['Date']), "Date column should be datetime type"
E   AssertionError: Date column should be datetime type
E   assert False
E    +  where False = <function is_datetime64_any_dtype at 0x000002CAC607AC00>(Series([], Name: Date, dtype: object))
E    +    where <function is_datetime64_any_dtype at 0x000002CAC607AC00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_datetime64_any_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (0, 5), expected (100, 5)
E   assert (0, 5) == (100, 5)
E     
E     At index 0 diff: 0 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?     --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (0, 5), expected (100, 5)\nassert (0, 5) == (100, 5)\n  \n  At index 0 diff: 0 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?     --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 2.26s =========================

2025-09-16 13:19:11,075 - ERROR - [FAILED] Failed after 3 attempts
2025-09-16 13:19:11,075 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 13:23:05,226 - INFO - Initialized Gemini client
2025-09-16 13:23:05,227 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 13:23:05,550 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 13:23:05,550 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:23:09,856 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:23:09,857 - INFO - [TEST] Running tests...
2025-09-16 13:23:13,301 - ERROR - [FAIL] Tests failed!
2025-09-16 13:23:13,301 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:84: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:94: in test_parse_data_types
    assert pd.api.types.is_datetime64_any_dtype(result['Date']), "Date column should be datetime type"
E   AssertionError: Date column should be datetime type
E   assert False
E    +  where False = <function is_datetime64_any_dtype at 0x000001EFA332AC00>(Series([], Name: Date, dtype: object))
E    +    where <function is_datetime64_any_dtype at 0x000001EFA332AC00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_datetime64_any_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (0, 5), expected (100, 5)
E   assert (0, 5) == (100, 5)
E     
E     At index 0 diff: 0 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?     --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (0, 5), expected (100, 5)\nassert (0, 5) == (100, 5)\n  \n  At index 0 diff: 0 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?     --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:8: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:158: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:12: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 4 failed, 3 passed in 1.91s =========================

2025-09-16 13:23:13,302 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:84: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:94: in test_parse_data_types
    assert pd.api.types.is_datetime64_any_dtype(result['Date']), "Date column should be datetime type"
E   AssertionError: Date column should be datetime type
E   assert False
E    +  where False = <function is_datetime64_any_dtype at 0x000001EFA332AC00>(Series([], Name: Date, dtype: object))
E    +    where <function is_datetime64_any_dtype at 0x000001EFA332AC00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_datetime64_any_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (0, 5), expected (100, 5)
E   assert (0, 5) == (100, 5)
E     
E     At index 0 diff: 0 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?     --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (0, 5), expected (100, 5)\nassert (0, 5) == (100, 5)\n  \n  At index 0 diff: 0 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?     --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:8: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:158: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:12: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 4 failed, 3 passed in 1.91s =========================

2025-09-16 13:23:13,303 - INFO - [RETRY] Retrying with improved code...
2025-09-16 13:23:13,304 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 13:23:13,304 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:23:17,929 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:23:17,930 - INFO - [TEST] Running tests...
2025-09-16 13:23:22,003 - ERROR - [FAIL] Tests failed!
2025-09-16 13:23:22,003 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:84: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:94: in test_parse_data_types
    assert pd.api.types.is_datetime64_any_dtype(result['Date']), "Date column should be datetime type"
E   AssertionError: Date column should be datetime type
E   assert False
E    +  where False = <function is_datetime64_any_dtype at 0x00000205280DAC00>(Series([], Name: Date, dtype: object))
E    +    where <function is_datetime64_any_dtype at 0x00000205280DAC00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_datetime64_any_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (0, 5), expected (100, 5)
E   assert (0, 5) == (100, 5)
E     
E     At index 0 diff: 0 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?     --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (0, 5), expected (100, 5)\nassert (0, 5) == (100, 5)\n  \n  At index 0 diff: 0 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?     --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 2.28s =========================

2025-09-16 13:23:22,003 - WARNING - [FAILED] Attempt 2 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:84: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:94: in test_parse_data_types
    assert pd.api.types.is_datetime64_any_dtype(result['Date']), "Date column should be datetime type"
E   AssertionError: Date column should be datetime type
E   assert False
E    +  where False = <function is_datetime64_any_dtype at 0x00000205280DAC00>(Series([], Name: Date, dtype: object))
E    +    where <function is_datetime64_any_dtype at 0x00000205280DAC00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_datetime64_any_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (0, 5), expected (100, 5)
E   assert (0, 5) == (100, 5)
E     
E     At index 0 diff: 0 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?     --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (0, 5), expected (100, 5)\nassert (0, 5) == (100, 5)\n  \n  At index 0 diff: 0 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?     --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 2.28s =========================

2025-09-16 13:23:22,004 - INFO - [RETRY] Retrying with improved code...
2025-09-16 13:23:22,004 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 13:23:22,004 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:23:25,625 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:23:25,627 - INFO - [TEST] Running tests...
2025-09-16 13:23:30,144 - ERROR - [FAIL] Tests failed!
2025-09-16 13:23:30,144 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
custom_parser\icici_parser.py:22: in parse
    return df[['Date', 'Description', 'Debit', 'Credit', 'Balance']]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\frame.py:4108: in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6200: in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6249: in _raise_if_missing
    raise KeyError(f"None of [{key}] are in the [{axis_name}]")
E   KeyError: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:69: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"
_______________ TestICICIParser.test_parse_dataframe_structure ________________
custom_parser\icici_parser.py:22: in parse
    return df[['Date', 'Description', 'Debit', 'Credit', 'Balance']]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\frame.py:4108: in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6200: in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6249: in _raise_if_missing
    raise KeyError(f"None of [{key}] are in the [{axis_name}]")
E   KeyError: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:77: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"
____________________ TestICICIParser.test_parse_data_types ____________________
custom_parser\icici_parser.py:22: in parse
    return df[['Date', 'Description', 'Debit', 'Credit', 'Balance']]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\frame.py:4108: in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6200: in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6249: in _raise_if_missing
    raise KeyError(f"None of [{key}] are in the [{axis_name}]")
E   KeyError: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:91: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"
______________ TestICICIParser.test_parse_matches_expected_data _______________
custom_parser\icici_parser.py:22: in parse
    return df[['Date', 'Description', 'Debit', 'Credit', 'Balance']]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\frame.py:4108: in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6200: in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6249: in _raise_if_missing
    raise KeyError(f"None of [{key}] are in the [{axis_name}]")
E   KeyError: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:105: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 2.76s =========================

2025-09-16 13:23:30,145 - WARNING - [FAILED] Attempt 3 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
custom_parser\icici_parser.py:22: in parse
    return df[['Date', 'Description', 'Debit', 'Credit', 'Balance']]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\frame.py:4108: in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6200: in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6249: in _raise_if_missing
    raise KeyError(f"None of [{key}] are in the [{axis_name}]")
E   KeyError: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:69: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"
_______________ TestICICIParser.test_parse_dataframe_structure ________________
custom_parser\icici_parser.py:22: in parse
    return df[['Date', 'Description', 'Debit', 'Credit', 'Balance']]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\frame.py:4108: in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6200: in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6249: in _raise_if_missing
    raise KeyError(f"None of [{key}] are in the [{axis_name}]")
E   KeyError: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:77: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"
____________________ TestICICIParser.test_parse_data_types ____________________
custom_parser\icici_parser.py:22: in parse
    return df[['Date', 'Description', 'Debit', 'Credit', 'Balance']]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\frame.py:4108: in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6200: in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6249: in _raise_if_missing
    raise KeyError(f"None of [{key}] are in the [{axis_name}]")
E   KeyError: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:91: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"
______________ TestICICIParser.test_parse_matches_expected_data _______________
custom_parser\icici_parser.py:22: in parse
    return df[['Date', 'Description', 'Debit', 'Credit', 'Balance']]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\frame.py:4108: in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6200: in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\indexes\base.py:6249: in _raise_if_missing
    raise KeyError(f"None of [{key}] are in the [{axis_name}]")
E   KeyError: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:105: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: "None of [Index(['Date', 'Description', 'Debit', 'Credit', 'Balance'], dtype='object')] are in the [columns]"
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 2.76s =========================

2025-09-16 13:23:30,146 - ERROR - [FAILED] Failed after 3 attempts
2025-09-16 13:23:30,146 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 13:28:23,760 - INFO - Initialized Gemini client
2025-09-16 13:28:23,761 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 13:28:24,091 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 13:28:24,091 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:28:30,096 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:28:30,097 - INFO - [TEST] Running tests...
2025-09-16 13:28:34,050 - ERROR - [FAIL] Tests failed!
2025-09-16 13:28:34,051 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:69: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:77: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:91: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:105: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:8: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:158: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:12: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 5 failed, 2 passed in 1.99s =========================

2025-09-16 13:28:34,052 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:69: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:77: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:91: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:105: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:29: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:8: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:158: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:12: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 5 failed, 2 passed in 1.99s =========================

2025-09-16 13:28:34,052 - INFO - [RETRY] Retrying with improved code...
2025-09-16 13:28:34,052 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 13:28:34,053 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:28:37,967 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:28:37,975 - INFO - [TEST] Running tests...
2025-09-16 13:28:41,485 - ERROR - [FAIL] Tests failed!
2025-09-16 13:28:41,485 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:84: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:94: in test_parse_data_types
    assert pd.api.types.is_datetime64_any_dtype(result['Date']), "Date column should be datetime type"
E   AssertionError: Date column should be datetime type
E   assert False
E    +  where False = <function is_datetime64_any_dtype at 0x00000199711BAC00>(Series([], Name: Date, dtype: object))
E    +    where <function is_datetime64_any_dtype at 0x00000199711BAC00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_datetime64_any_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (0, 5), expected (100, 5)
E   assert (0, 5) == (100, 5)
E     
E     At index 0 diff: 0 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?     --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (0, 5), expected (100, 5)\nassert (0, 5) == (100, 5)\n  \n  At index 0 diff: 0 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?     --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 1.92s =========================

2025-09-16 13:28:41,486 - WARNING - [FAILED] Attempt 2 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:84: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:94: in test_parse_data_types
    assert pd.api.types.is_datetime64_any_dtype(result['Date']), "Date column should be datetime type"
E   AssertionError: Date column should be datetime type
E   assert False
E    +  where False = <function is_datetime64_any_dtype at 0x00000199711BAC00>(Series([], Name: Date, dtype: object))
E    +    where <function is_datetime64_any_dtype at 0x00000199711BAC00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_datetime64_any_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:114: in test_parse_matches_expected_data
    assert result_sorted.shape == expected_sorted.shape, \
E   AssertionError: Shape mismatch: got (0, 5), expected (100, 5)
E   assert (0, 5) == (100, 5)
E     
E     At index 0 diff: 0 != 100
E     
E     Full diff:
E       (
E     -     100,
E     ?     --...
E     
E     ...Full output truncated (3 lines hidden), use '-vv' to show
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Shape mismatch: got (0, 5), expected (100, 5)\nassert (0, 5) == (100, 5)\n  \n  At index 0 diff: 0 != 100\n  \n  Full diff:\n    (\n  -     100,\n  ?     --...\n  \n  ...Full output truncated (3 lines hidden), use '-vv' to show\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 1.92s =========================

2025-09-16 13:28:41,486 - INFO - [RETRY] Retrying with improved code...
2025-09-16 13:28:41,486 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 13:28:41,487 - INFO - [GENERATE] Generating parser code...
2025-09-16 13:28:46,143 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 13:28:46,144 - INFO - [TEST] Running tests...
2025-09-16 13:28:50,035 - ERROR - [FAIL] Tests failed!
2025-09-16 13:28:50,036 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:130: in test_parse_matches_expected_data
    assert result_row[col] == expected_row[col], \
E   AssertionError: Row 0, Column Debit: got 193.0, expected 1935.3
E   assert 193.0 == 1935.3
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Row 0, Column Debit: got 193.0, expected 1935.3\nassert 193.0 == 1935.3\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\n        Date                Description  Debit  Credit  Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  193.0    5.30    686.0\n1 2024-08-02  Salary Credit XYZ Pvt Ltd  165.0    2.61    851.0\n2 2024-08-03    IMPS UPI Payment Amazon  388.0    6.08    463.0\n3 2024-08-03    Mobile Recharge Via UPI  164.0    8.72    627.0\n4 2024-08-14   Fuel Purchase Debit Card  387.0    8.57    101.0\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.03s =========================

2025-09-16 13:28:50,036 - WARNING - [FAILED] Attempt 3 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:130: in test_parse_matches_expected_data
    assert result_row[col] == expected_row[col], \
E   AssertionError: Row 0, Column Debit: got 193.0, expected 1935.3
E   assert 193.0 == 1935.3
---------------------------- Captured stdout call -----------------------------
\u274c Data comparison failed: Row 0, Column Debit: got 193.0, expected 1935.3\nassert 193.0 == 1935.3\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\n\nFirst 5 rows of result:\n        Date                Description  Debit  Credit  Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  193.0    5.30    686.0\n1 2024-08-02  Salary Credit XYZ Pvt Ltd  165.0    2.61    851.0\n2 2024-08-03    IMPS UPI Payment Amazon  388.0    6.08    463.0\n3 2024-08-03    Mobile Recharge Via UPI  164.0    8.72    627.0\n4 2024-08-14   Fuel Purchase Debit Card  387.0    8.57    101.0\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30      NaN   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd      NaN  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08      NaN   4631.11\n3 2024-08-03    Mobile Recharge Via UPI      NaN  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card      NaN  3878.57  10158.40
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.03s =========================

2025-09-16 13:28:50,036 - ERROR - [FAILED] Failed after 3 attempts
2025-09-16 13:28:50,037 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 14:55:02,386 - INFO - Initialized Gemini client
2025-09-16 14:55:02,387 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 14:55:02,820 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 14:55:02,821 - INFO - [GENERATE] Generating parser code...
2025-09-16 14:55:08,093 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 14:55:08,095 - INFO - [TEST] Running tests...
2025-09-16 14:55:11,691 - ERROR - [FAIL] Tests failed!
2025-09-16 14:55:11,691 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:73: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:81: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:95: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:109: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:8: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:162: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:12: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 5 failed, 2 passed in 1.99s =========================

2025-09-16 14:55:11,692 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:73: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:81: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:95: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:109: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:26: in parse
    balance = float(balance.replace(',', ''))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   ValueError: could not convert string to float: ''
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:8: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:162: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:12: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 5 failed, 2 passed in 1.99s =========================

2025-09-16 14:55:11,694 - INFO - [RETRY] Retrying with improved code...
2025-09-16 14:55:11,694 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 14:55:11,694 - INFO - [GENERATE] Generating parser code...
2025-09-16 14:55:15,974 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 14:55:15,974 - INFO - [TEST] Running tests...
2025-09-16 14:55:20,350 - ERROR - [FAIL] Tests failed!
2025-09-16 14:55:20,350 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000001B3B8ACAF20>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000001B3B8ACAF20> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 2.45s =========================

2025-09-16 14:55:20,351 - WARNING - [FAILED] Attempt 2 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000001B3B8ACAF20>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000001B3B8ACAF20> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 2.45s =========================

2025-09-16 14:55:20,352 - INFO - [RETRY] Retrying with improved code...
2025-09-16 14:55:20,352 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 14:55:20,352 - INFO - [GENERATE] Generating parser code...
2025-09-16 14:55:25,734 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 14:55:25,734 - INFO - [TEST] Running tests...
2025-09-16 14:55:29,521 - ERROR - [FAIL] Tests failed!
2025-09-16 14:55:29,521 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals =          Date                       Description  Debit  Credit  Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd    0.0     0.0     4.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd    0.0     0.0     7.19\n2  2024-08-03           IMPS UPI Payment Amazon    0.0     0.0     1.11\n3  2024-08-03           Mobile Recharge Via UPI    0.0     0.0     9.83\n4  2024-08-14          Fuel Purchase Debit Card    0.0     0.0    58.40\n..        ...                               ...    ...     ...      ...\n95 2025-07-20  Utility Bill Payment Electricity    0.0     0.0     6.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd    0.0     0.0     4.60\n97 2025-07-24      Electricity Bill NEFT Online    0.0     0.0     7.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd    0.0     0.0     0.76\n99 2025-07-27         ATM Cash Withdrawal India    0.0     0.0     6.77\n\n[100 rows x 5 columns].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\n        Date                Description  Debit  Credit  Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd    0.0     0.0     4.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd    0.0     0.0     7.19\n2 2024-08-03    IMPS UPI Payment Amazon    0.0     0.0     1.11\n3 2024-08-03    Mobile Recharge Via UPI    0.0     0.0     9.83\n4 2024-08-14   Fuel Purchase Debit Card    0.0     0.0    58.40\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals =          Date                       Description  Debit  Credit  Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd    0.0     0.0     4.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd    0.0     0.0     7.19\\n2  2024-08-03           IMPS UPI Payment Amazon    0.0     0.0     1.11\\n3  2024-08-03           Mobile Recharge Via UPI    0.0     0.0     9.83\\n4  2024-08-14          Fuel Purchase Debit Card    0.0     0.0    58.40\\n..        ...                               ...    ...     ...      ...\\n95 2025-07-20  Utility Bill Payment Electricity    0.0     0.0     6.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd    0.0     0.0     4.60\\n97 2025-07-24      Electricity Bill NEFT Online    0.0     0.0     7.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd    0.0     0.0     0.76\\n99 2025-07-27         ATM Cash Withdrawal India    0.0     0.0     6.77\\n\\n[100 rows x 5 columns].equals
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:9: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:162: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:46: in parse
    except (pdfplumber.pdfplumber.EmptyFileError, pdfplumber.pdfplumber.PageNotFoundError) :
            ^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber' has no attribute 'pdfplumber'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 2 failed, 5 passed in 2.02s =========================

2025-09-16 14:55:29,521 - WARNING - [FAILED] Attempt 3 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals =          Date                       Description  Debit  Credit  Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd    0.0     0.0     4.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd    0.0     0.0     7.19\n2  2024-08-03           IMPS UPI Payment Amazon    0.0     0.0     1.11\n3  2024-08-03           Mobile Recharge Via UPI    0.0     0.0     9.83\n4  2024-08-14          Fuel Purchase Debit Card    0.0     0.0    58.40\n..        ...                               ...    ...     ...      ...\n95 2025-07-20  Utility Bill Payment Electricity    0.0     0.0     6.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd    0.0     0.0     4.60\n97 2025-07-24      Electricity Bill NEFT Online    0.0     0.0     7.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd    0.0     0.0     0.76\n99 2025-07-27         ATM Cash Withdrawal India    0.0     0.0     6.77\n\n[100 rows x 5 columns].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\n        Date                Description  Debit  Credit  Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd    0.0     0.0     4.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd    0.0     0.0     7.19\n2 2024-08-03    IMPS UPI Payment Amazon    0.0     0.0     1.11\n3 2024-08-03    Mobile Recharge Via UPI    0.0     0.0     9.83\n4 2024-08-14   Fuel Purchase Debit Card    0.0     0.0    58.40\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals =          Date                       Description  Debit  Credit  Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd    0.0     0.0     4.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd    0.0     0.0     7.19\\n2  2024-08-03           IMPS UPI Payment Amazon    0.0     0.0     1.11\\n3  2024-08-03           Mobile Recharge Via UPI    0.0     0.0     9.83\\n4  2024-08-14          Fuel Purchase Debit Card    0.0     0.0    58.40\\n..        ...                               ...    ...     ...      ...\\n95 2025-07-20  Utility Bill Payment Electricity    0.0     0.0     6.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd    0.0     0.0     4.60\\n97 2025-07-24      Electricity Bill NEFT Online    0.0     0.0     7.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd    0.0     0.0     0.76\\n99 2025-07-27         ATM Cash Withdrawal India    0.0     0.0     6.77\\n\\n[100 rows x 5 columns].equals
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:9: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:162: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:46: in parse
    except (pdfplumber.pdfplumber.EmptyFileError, pdfplumber.pdfplumber.PageNotFoundError) :
            ^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber' has no attribute 'pdfplumber'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 2 failed, 5 passed in 2.02s =========================

2025-09-16 14:55:29,521 - ERROR - [FAILED] Failed after 3 attempts
2025-09-16 14:55:29,521 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 14:58:32,340 - INFO - Initialized Gemini client
2025-09-16 14:58:32,341 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 14:58:32,694 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 14:58:32,696 - INFO - [GENERATE] Generating parser code...
2025-09-16 14:58:38,435 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 14:58:38,437 - INFO - [TEST] Running tests...
2025-09-16 14:58:41,707 - ERROR - [FAIL] Tests failed!
2025-09-16 14:58:41,707 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000001A618F6AF20>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000001A618F6AF20> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:7: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:162: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:41: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 4 failed, 3 passed in 1.53s =========================

2025-09-16 14:58:41,709 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000001A618F6AF20>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000001A618F6AF20> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:7: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:162: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:41: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 4 failed, 3 passed in 1.53s =========================

2025-09-16 14:58:41,711 - INFO - [RETRY] Retrying with improved code...
2025-09-16 14:58:41,711 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 14:58:41,712 - INFO - [GENERATE] Generating parser code...
2025-09-16 14:58:48,113 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 14:58:48,114 - INFO - [TEST] Running tests...
2025-09-16 14:58:52,540 - ERROR - [FAIL] Tests failed!
2025-09-16 14:58:52,541 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals =          Date                       Description   Debit  Credit  Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  193.00    5.30   686.00\n1  2024-08-02         Salary Credit XYZ Pvt Ltd  165.00    2.61   851.00\n2  2024-08-03           IMPS UPI Payment Amazon  388.00    6.08   463.00\n3  2024-08-03           Mobile Recharge Via UPI  164.00    8.72   627.00\n4  2024-08-14          Fuel Purchase Debit Card  387.00    8.57   101.00\n..        ...                               ...     ...     ...      ...\n95 2025-07-20  Utility Bill Payment Electricity  298.00    9.23   392.00\n96 2025-07-23         Salary Credit XYZ Pvt Ltd  298.00    8.46   691.00\n97 2025-07-24      Electricity Bill NEFT Online  291.00    7.52   399.00\n98 2025-07-25         Salary Credit XYZ Pvt Ltd  566.32  343.00     0.76\n99 2025-07-27         ATM Cash Withdrawal India  215.00    6.01   558.00\n\n[100 rows x 5 columns].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\n        Date                Description  Debit  Credit  Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  193.0    5.30    686.0\n1 2024-08-02  Salary Credit XYZ Pvt Ltd  165.0    2.61    851.0\n2 2024-08-03    IMPS UPI Payment Amazon  388.0    6.08    463.0\n3 2024-08-03    Mobile Recharge Via UPI  164.0    8.72    627.0\n4 2024-08-14   Fuel Purchase Debit Card  387.0    8.57    101.0\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals =          Date                       Description   Debit  Credit  Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  193.00    5.30   686.00\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd  165.00    2.61   851.00\\n2  2024-08-03           IMPS UPI Payment Amazon  388.00    6.08   463.00\\n3  2024-08-03           Mobile Recharge Via UPI  164.00    8.72   627.00\\n4  2024-08-14          Fuel Purchase Debit Card  387.00    8.57   101.00\\n..        ...                               ...     ...     ...      ...\\n95 2025-07-20  Utility Bill Payment Electricity  298.00    9.23   392.00\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd  298.00    8.46   691.00\\n97 2025-07-24      Electricity Bill NEFT Online  291.00    7.52   399.00\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd  566.32  343.00     0.76\\n99 2025-07-27         ATM Cash Withdrawal India  215.00    6.01   558.00\\n\\n[100 rows x 5 columns].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.51s =========================

2025-09-16 14:58:52,543 - WARNING - [FAILED] Attempt 2 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals =          Date                       Description   Debit  Credit  Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  193.00    5.30   686.00\n1  2024-08-02         Salary Credit XYZ Pvt Ltd  165.00    2.61   851.00\n2  2024-08-03           IMPS UPI Payment Amazon  388.00    6.08   463.00\n3  2024-08-03           Mobile Recharge Via UPI  164.00    8.72   627.00\n4  2024-08-14          Fuel Purchase Debit Card  387.00    8.57   101.00\n..        ...                               ...     ...     ...      ...\n95 2025-07-20  Utility Bill Payment Electricity  298.00    9.23   392.00\n96 2025-07-23         Salary Credit XYZ Pvt Ltd  298.00    8.46   691.00\n97 2025-07-24      Electricity Bill NEFT Online  291.00    7.52   399.00\n98 2025-07-25         Salary Credit XYZ Pvt Ltd  566.32  343.00     0.76\n99 2025-07-27         ATM Cash Withdrawal India  215.00    6.01   558.00\n\n[100 rows x 5 columns].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\n        Date                Description  Debit  Credit  Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  193.0    5.30    686.0\n1 2024-08-02  Salary Credit XYZ Pvt Ltd  165.0    2.61    851.0\n2 2024-08-03    IMPS UPI Payment Amazon  388.0    6.08    463.0\n3 2024-08-03    Mobile Recharge Via UPI  164.0    8.72    627.0\n4 2024-08-14   Fuel Purchase Debit Card  387.0    8.57    101.0\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals =          Date                       Description   Debit  Credit  Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  193.00    5.30   686.00\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd  165.00    2.61   851.00\\n2  2024-08-03           IMPS UPI Payment Amazon  388.00    6.08   463.00\\n3  2024-08-03           Mobile Recharge Via UPI  164.00    8.72   627.00\\n4  2024-08-14          Fuel Purchase Debit Card  387.00    8.57   101.00\\n..        ...                               ...     ...     ...      ...\\n95 2025-07-20  Utility Bill Payment Electricity  298.00    9.23   392.00\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd  298.00    8.46   691.00\\n97 2025-07-24      Electricity Bill NEFT Online  291.00    7.52   399.00\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd  566.32  343.00     0.76\\n99 2025-07-27         ATM Cash Withdrawal India  215.00    6.01   558.00\\n\\n[100 rows x 5 columns].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.51s =========================

2025-09-16 14:58:52,548 - INFO - [RETRY] Retrying with improved code...
2025-09-16 14:58:52,548 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 14:58:52,549 - INFO - [GENERATE] Generating parser code...
2025-09-16 14:58:57,876 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 14:58:57,879 - INFO - [TEST] Running tests...
2025-09-16 14:59:02,747 - ERROR - [FAIL] Tests failed!
2025-09-16 14:59:02,748 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000001EF4024AF20>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000001EF4024AF20> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 2.73s =========================

2025-09-16 14:59:02,751 - WARNING - [FAILED] Attempt 3 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000001EF4024AF20>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000001EF4024AF20> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 2.73s =========================

2025-09-16 14:59:02,752 - ERROR - [FAILED] Failed after 3 attempts
2025-09-16 14:59:02,753 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 15:03:49,588 - INFO - Initialized Gemini client
2025-09-16 15:03:49,588 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 15:03:49,928 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 15:03:49,928 - INFO - [GENERATE] Generating parser code...
2025-09-16 15:03:54,425 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 15:03:54,425 - INFO - [TEST] Running tests...
2025-09-16 15:03:58,492 - ERROR - [FAIL] Tests failed!
2025-09-16 15:03:58,492 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x0000011E2660AF20>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x0000011E2660AF20> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 2.23s =========================

2025-09-16 15:03:58,492 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x0000011E2660AF20>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x0000011E2660AF20> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 2.23s =========================

2025-09-16 15:03:58,493 - INFO - [RETRY] Retrying with improved code...
2025-09-16 15:03:58,493 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 15:03:58,493 - INFO - [GENERATE] Generating parser code...
2025-09-16 15:04:04,869 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 15:04:04,870 - INFO - [TEST] Running tests...
2025-09-16 15:04:08,851 - ERROR - [FAIL] Tests failed!
2025-09-16 15:04:08,851 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000001A89C37AF20>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000001A89C37AF20> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 2.14s =========================

2025-09-16 15:04:08,852 - WARNING - [FAILED] Attempt 2 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000001A89C37AF20>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000001A89C37AF20> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 2.14s =========================

2025-09-16 15:04:08,852 - INFO - [RETRY] Retrying with improved code...
2025-09-16 15:04:08,852 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 15:04:08,852 - INFO - [GENERATE] Generating parser code...
2025-09-16 15:04:15,109 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 15:04:15,109 - INFO - [TEST] Running tests...
2025-09-16 15:04:19,216 - ERROR - [FAIL] Tests failed!
2025-09-16 15:04:19,216 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals =          Date  Description  Debit  Credit  Balance\n0  2024-08-01       Salary    0.0     0.0      0.0\n1  2024-08-02       Salary    0.0     0.0      0.0\n2  2024-08-03         IMPS    0.0     0.0      0.0\n3  2024-08-03       Mobile    0.0     0.0      0.0\n4  2024-08-14         Fuel    0.0     0.0      0.0\n..        ...          ...    ...     ...      ...\n95 2025-07-20      Utility    0.0     0.0      0.0\n96 2025-07-23       Salary    0.0     0.0      0.0\n97 2025-07-24  Electricity    0.0     0.0      0.0\n98 2025-07-25       Salary    0.0     0.0      0.0\n99 2025-07-27          ATM    0.0     0.0      0.0\n\n[100 rows x 5 columns].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\n        Date Description  Debit  Credit  Balance\n0 2024-08-01      Salary    0.0     0.0      0.0\n1 2024-08-02      Salary    0.0     0.0      0.0\n2 2024-08-03        IMPS    0.0     0.0      0.0\n3 2024-08-03      Mobile    0.0     0.0      0.0\n4 2024-08-14        Fuel    0.0     0.0      0.0\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals =          Date  Description  Debit  Credit  Balance\\n0  2024-08-01       Salary    0.0     0.0      0.0\\n1  2024-08-02       Salary    0.0     0.0      0.0\\n2  2024-08-03         IMPS    0.0     0.0      0.0\\n3  2024-08-03       Mobile    0.0     0.0      0.0\\n4  2024-08-14         Fuel    0.0     0.0      0.0\\n..        ...          ...    ...     ...      ...\\n95 2025-07-20      Utility    0.0     0.0      0.0\\n96 2025-07-23       Salary    0.0     0.0      0.0\\n97 2025-07-24  Electricity    0.0     0.0      0.0\\n98 2025-07-25       Salary    0.0     0.0      0.0\\n99 2025-07-27          ATM    0.0     0.0      0.0\\n\\n[100 rows x 5 columns].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.23s =========================

2025-09-16 15:04:19,216 - WARNING - [FAILED] Attempt 3 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals =          Date  Description  Debit  Credit  Balance\n0  2024-08-01       Salary    0.0     0.0      0.0\n1  2024-08-02       Salary    0.0     0.0      0.0\n2  2024-08-03         IMPS    0.0     0.0      0.0\n3  2024-08-03       Mobile    0.0     0.0      0.0\n4  2024-08-14         Fuel    0.0     0.0      0.0\n..        ...          ...    ...     ...      ...\n95 2025-07-20      Utility    0.0     0.0      0.0\n96 2025-07-23       Salary    0.0     0.0      0.0\n97 2025-07-24  Electricity    0.0     0.0      0.0\n98 2025-07-25       Salary    0.0     0.0      0.0\n99 2025-07-27          ATM    0.0     0.0      0.0\n\n[100 rows x 5 columns].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\n        Date Description  Debit  Credit  Balance\n0 2024-08-01      Salary    0.0     0.0      0.0\n1 2024-08-02      Salary    0.0     0.0      0.0\n2 2024-08-03        IMPS    0.0     0.0      0.0\n3 2024-08-03      Mobile    0.0     0.0      0.0\n4 2024-08-14        Fuel    0.0     0.0      0.0\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals =          Date  Description  Debit  Credit  Balance\\n0  2024-08-01       Salary    0.0     0.0      0.0\\n1  2024-08-02       Salary    0.0     0.0      0.0\\n2  2024-08-03         IMPS    0.0     0.0      0.0\\n3  2024-08-03       Mobile    0.0     0.0      0.0\\n4  2024-08-14         Fuel    0.0     0.0      0.0\\n..        ...          ...    ...     ...      ...\\n95 2025-07-20      Utility    0.0     0.0      0.0\\n96 2025-07-23       Salary    0.0     0.0      0.0\\n97 2025-07-24  Electricity    0.0     0.0      0.0\\n98 2025-07-25       Salary    0.0     0.0      0.0\\n99 2025-07-27          ATM    0.0     0.0      0.0\\n\\n[100 rows x 5 columns].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.23s =========================

2025-09-16 15:04:19,216 - ERROR - [FAILED] Failed after 3 attempts
2025-09-16 15:04:19,216 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 15:12:55,529 - INFO - Initialized Gemini client
2025-09-16 15:12:55,530 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 15:12:55,819 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 15:12:55,819 - INFO - [GENERATE] Generating parser code...
2025-09-16 15:13:02,502 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 15:13:02,503 - INFO - [TEST] Running tests...
2025-09-16 15:13:05,169 - INFO - [PASS] All tests passed!
2025-09-16 15:13:05,170 - INFO - [SUCCESS] Parser generated and tested successfully in 1 attempt(s)
2025-09-16 15:13:05,170 - INFO - [COMPLETE] Agent completed successfully!
2025-09-16 15:13:36,010 - INFO - Initialized Gemini client
2025-09-16 15:13:36,011 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 15:13:36,304 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 15:13:36,304 - INFO - [GENERATE] Generating parser code...
2025-09-16 15:13:39,404 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 15:13:39,405 - INFO - [TEST] Running tests...
2025-09-16 15:13:42,296 - INFO - [PASS] All tests passed!
2025-09-16 15:13:42,297 - INFO - [SUCCESS] Parser generated and tested successfully in 1 attempt(s)
2025-09-16 15:13:42,297 - INFO - [COMPLETE] Agent completed successfully!
2025-09-16 21:55:53,878 - INFO - Initialized Gemini client
2025-09-16 21:55:53,879 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 21:55:54,208 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 21:55:54,209 - INFO - [GENERATE] Generating parser code...
2025-09-16 21:55:58,907 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 21:55:58,908 - INFO - [TEST] Running tests...
2025-09-16 21:56:02,190 - ERROR - [FAIL] Tests failed!
2025-09-16 21:56:02,190 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x0000027EB1F15D00>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x0000027EB1F15D00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:7: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:162: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:58: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 4 failed, 3 passed in 1.57s =========================

2025-09-16 21:56:02,191 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x0000027EB1F15D00>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x0000027EB1F15D00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:7: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:162: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:58: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 4 failed, 3 passed in 1.57s =========================

2025-09-16 21:56:02,191 - INFO - [RETRY] Retrying with improved code...
2025-09-16 21:56:02,191 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 21:56:02,191 - INFO - [GENERATE] Generating parser code...
2025-09-16 21:56:06,893 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 21:56:06,893 - INFO - [TEST] Running tests...
2025-09-16 21:56:11,244 - ERROR - [FAIL] Tests failed!
2025-09-16 21:56:11,244 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:73: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:81: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:95: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:109: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - r...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 2.47s =========================

2025-09-16 21:56:11,245 - WARNING - [FAILED] Attempt 2 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:73: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:81: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:95: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:109: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - r...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 2.47s =========================

2025-09-16 21:56:11,245 - INFO - [RETRY] Retrying with improved code...
2025-09-16 21:56:11,245 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 21:56:11,245 - INFO - [GENERATE] Generating parser code...
2025-09-16 21:56:15,515 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 21:56:15,516 - INFO - [TEST] Running tests...
2025-09-16 21:56:19,250 - ERROR - [FAIL] Tests failed!
2025-09-16 21:56:19,251 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
custom_parser\icici_parser.py:19: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:73: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:36: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: redefinition of group name 'amount' as group 4; was group 3 at position 105
_______________ TestICICIParser.test_parse_dataframe_structure ________________
custom_parser\icici_parser.py:19: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:81: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:36: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: redefinition of group name 'amount' as group 4; was group 3 at position 105
____________________ TestICICIParser.test_parse_data_types ____________________
custom_parser\icici_parser.py:19: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:95: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:36: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: redefinition of group name 'amount' as group 4; was group 3 at position 105
______________ TestICICIParser.test_parse_matches_expected_data _______________
custom_parser\icici_parser.py:19: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:109: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:36: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: redefinition of group name 'amount' as group 4; was group 3 at position 105
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 1.79s =========================

2025-09-16 21:56:19,251 - WARNING - [FAILED] Attempt 3 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
custom_parser\icici_parser.py:19: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:73: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:36: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: redefinition of group name 'amount' as group 4; was group 3 at position 105
_______________ TestICICIParser.test_parse_dataframe_structure ________________
custom_parser\icici_parser.py:19: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:81: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:36: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: redefinition of group name 'amount' as group 4; was group 3 at position 105
____________________ TestICICIParser.test_parse_data_types ____________________
custom_parser\icici_parser.py:19: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:95: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:36: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: redefinition of group name 'amount' as group 4; was group 3 at position 105
______________ TestICICIParser.test_parse_matches_expected_data _______________
custom_parser\icici_parser.py:19: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.*?)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")", line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 105

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:109: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:36: in parse
    raise ValueError(f"Error parsing PDF: {e}")
E   ValueError: Error parsing PDF: redefinition of group name 'amount' as group 4; was group 3 at position 105
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 1.79s =========================

2025-09-16 21:56:19,252 - ERROR - [FAILED] Failed after 3 attempts
2025-09-16 21:56:19,252 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 21:57:28,716 - INFO - Initialized Gemini client
2025-09-16 21:57:28,717 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 21:57:29,063 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 21:57:29,063 - INFO - [GENERATE] Generating parser code...
2025-09-16 21:57:34,412 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 21:57:34,416 - INFO - [TEST] Running tests...
2025-09-16 21:57:37,812 - ERROR - [FAIL] Tests failed!
2025-09-16 21:57:37,813 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000001E256B71D00>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000001E256B71D00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:7: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:162: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:46: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 4 failed, 3 passed in 1.59s =========================

2025-09-16 21:57:37,814 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000001E256B71D00>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000001E256B71D00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:7: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:162: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:46: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 4 failed, 3 passed in 1.59s =========================

2025-09-16 21:57:37,815 - INFO - [RETRY] Retrying with improved code...
2025-09-16 21:57:37,816 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 21:57:37,816 - INFO - [GENERATE] Generating parser code...
2025-09-16 21:57:42,745 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 21:57:42,746 - INFO - [TEST] Running tests...
2025-09-16 21:57:46,710 - ERROR - [FAIL] Tests failed!
2025-09-16 21:57:46,710 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals =          Date Description  Debit  Credit  Balance\n0  2024-08-01                0.0     0.0     4.58\n1  2024-08-02                0.0     0.0     7.19\n2  2024-08-03                0.0     0.0     1.11\n3  2024-08-03                0.0     0.0     9.83\n4  2024-08-14                0.0     0.0    58.40\n..        ...         ...    ...     ...      ...\n95 2025-07-20                0.0     0.0     6.14\n96 2025-07-23                0.0     0.0     4.60\n97 2025-07-24                0.0     0.0     7.08\n98 2025-07-25                0.0     0.0     0.76\n99 2025-07-27                0.0     0.0     6.77\n\n[100 rows x 5 columns].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\n        Date Description  Debit  Credit  Balance\n0 2024-08-01                0.0     0.0     4.58\n1 2024-08-02                0.0     0.0     7.19\n2 2024-08-03                0.0     0.0     1.11\n3 2024-08-03                0.0     0.0     9.83\n4 2024-08-14                0.0     0.0    58.40\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals =          Date Description  Debit  Credit  Balance\\n0  2024-08-01                0.0     0.0     4.58\\n1  2024-08-02                0.0     0.0     7.19\\n2  2024-08-03                0.0     0.0     1.11\\n3  2024-08-03                0.0     0.0     9.83\\n4  2024-08-14                0.0     0.0    58.40\\n..        ...         ...    ...     ...      ...\\n95 2025-07-20                0.0     0.0     6.14\\n96 2025-07-23                0.0     0.0     4.60\\n97 2025-07-24                0.0     0.0     7.08\\n98 2025-07-25                0.0     0.0     0.76\\n99 2025-07-27                0.0     0.0     6.77\\n\\n[100 rows x 5 columns].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.21s =========================

2025-09-16 21:57:46,712 - WARNING - [FAILED] Attempt 2 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals =          Date Description  Debit  Credit  Balance\n0  2024-08-01                0.0     0.0     4.58\n1  2024-08-02                0.0     0.0     7.19\n2  2024-08-03                0.0     0.0     1.11\n3  2024-08-03                0.0     0.0     9.83\n4  2024-08-14                0.0     0.0    58.40\n..        ...         ...    ...     ...      ...\n95 2025-07-20                0.0     0.0     6.14\n96 2025-07-23                0.0     0.0     4.60\n97 2025-07-24                0.0     0.0     7.08\n98 2025-07-25                0.0     0.0     0.76\n99 2025-07-27                0.0     0.0     6.77\n\n[100 rows x 5 columns].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\n        Date Description  Debit  Credit  Balance\n0 2024-08-01                0.0     0.0     4.58\n1 2024-08-02                0.0     0.0     7.19\n2 2024-08-03                0.0     0.0     1.11\n3 2024-08-03                0.0     0.0     9.83\n4 2024-08-14                0.0     0.0    58.40\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals =          Date Description  Debit  Credit  Balance\\n0  2024-08-01                0.0     0.0     4.58\\n1  2024-08-02                0.0     0.0     7.19\\n2  2024-08-03                0.0     0.0     1.11\\n3  2024-08-03                0.0     0.0     9.83\\n4  2024-08-14                0.0     0.0    58.40\\n..        ...         ...    ...     ...      ...\\n95 2025-07-20                0.0     0.0     6.14\\n96 2025-07-23                0.0     0.0     4.60\\n97 2025-07-24                0.0     0.0     7.08\\n98 2025-07-25                0.0     0.0     0.76\\n99 2025-07-27                0.0     0.0     6.77\\n\\n[100 rows x 5 columns].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.21s =========================

2025-09-16 21:57:46,712 - INFO - [RETRY] Retrying with improved code...
2025-09-16 21:57:46,713 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 21:57:46,713 - INFO - [GENERATE] Generating parser code...
2025-09-16 21:57:53,355 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 21:57:53,355 - INFO - [TEST] Running tests...
2025-09-16 21:57:57,507 - ERROR - [FAIL] Tests failed!
2025-09-16 21:57:57,507 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals =         Date                     Description   Debit  Credit  Balance\n0 2025-06-30  Interest Credit Saving Account  150.91     0.0     6.06\n1 2025-07-14         Mobile Recharge Via UPI  380.91     0.0     1.44.equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (2, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\n        Date                     Description   Debit  Credit  Balance\n0 2025-06-30  Interest Credit Saving Account  150.91     0.0     6.06\n1 2025-07-14         Mobile Recharge Via UPI  380.91     0.0     1.44\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals =         Date                     Description   Debit  Credit  Balance\\n0 2025-06-30  Interest Credit Saving Account  150.91     0.0     6.06\\n1 2025-07-14         Mobile Recharge Via UPI  380.91     0.0     1.44.equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.25s =========================

2025-09-16 21:57:57,507 - WARNING - [FAILED] Attempt 3 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals =         Date                     Description   Debit  Credit  Balance\n0 2025-06-30  Interest Credit Saving Account  150.91     0.0     6.06\n1 2025-07-14         Mobile Recharge Via UPI  380.91     0.0     1.44.equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (2, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\n        Date                     Description   Debit  Credit  Balance\n0 2025-06-30  Interest Credit Saving Account  150.91     0.0     6.06\n1 2025-07-14         Mobile Recharge Via UPI  380.91     0.0     1.44\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals =         Date                     Description   Debit  Credit  Balance\\n0 2025-06-30  Interest Credit Saving Account  150.91     0.0     6.06\\n1 2025-07-14         Mobile Recharge Via UPI  380.91     0.0     1.44.equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.25s =========================

2025-09-16 21:57:57,507 - ERROR - [FAILED] Failed after 3 attempts
2025-09-16 21:57:57,507 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 22:00:11,022 - INFO - Initialized Gemini client
2025-09-16 22:00:11,023 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 22:00:11,364 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 22:00:11,365 - INFO - [GENERATE] Generating parser code...
2025-09-16 22:00:18,286 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 22:00:18,289 - INFO - [TEST] Running tests...
2025-09-16 22:00:21,799 - INFO - [PASS] All tests passed!
2025-09-16 22:00:21,799 - INFO - [SUCCESS] Parser generated and tested successfully in 1 attempt(s)
2025-09-16 22:00:21,800 - INFO - [COMPLETE] Agent completed successfully!
2025-09-16 22:01:00,319 - INFO - Initialized Gemini client
2025-09-16 22:01:00,319 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 22:01:00,642 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 22:01:00,642 - INFO - [GENERATE] Generating parser code...
2025-09-16 22:01:09,809 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 22:01:09,811 - INFO - [TEST] Running tests...
2025-09-16 22:01:12,811 - ERROR - [FAIL] Tests failed!
2025-09-16 22:01:12,811 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                   int64\nCredit                  int64\nBalance                 int64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:7: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:162: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:43: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 3 failed, 4 passed in 1.44s =========================

2025-09-16 22:01:12,811 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                   int64\nCredit                  int64\nBalance                 int64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:7: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:162: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:43: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 3 failed, 4 passed in 1.44s =========================

2025-09-16 22:01:12,812 - INFO - [RETRY] Retrying with improved code...
2025-09-16 22:01:12,812 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 22:01:12,812 - INFO - [GENERATE] Generating parser code...
2025-09-16 22:01:18,295 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 22:01:18,297 - INFO - [TEST] Running tests...
2025-09-16 22:01:22,172 - ERROR - [FAIL] Tests failed!
2025-09-16 22:01:22,172 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals =          Date                       Description  Debit  Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd    0.0   193.0   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd    0.0   165.0   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon    0.0   388.0   4631.11\n3  2024-08-03           Mobile Recharge Via UPI    0.0   164.0   6279.83\n4  2024-08-14          Fuel Purchase Debit Card    0.0   387.0  10158.40\n..        ...                               ...    ...     ...       ...\n95 2025-07-20  Utility Bill Payment Electricity    0.0   298.0   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd    0.0   298.0   6914.60\n97 2025-07-24      Electricity Bill NEFT Online    0.0   291.0   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd    0.0     0.0   3430.76\n99 2025-07-27         ATM Cash Withdrawal India    0.0   215.0   5586.77\n\n[100 rows x 5 columns].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\n        Date                Description  Debit  Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd    0.0   193.0   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd    0.0   165.0   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon    0.0   388.0   4631.11\n3 2024-08-03    Mobile Recharge Via UPI    0.0   164.0   6279.83\n4 2024-08-14   Fuel Purchase Debit Card    0.0   387.0  10158.40\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals =          Date                       Description  Debit  Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd    0.0   193.0   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd    0.0   165.0   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon    0.0   388.0   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI    0.0   164.0   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card    0.0   387.0  10158.40\\n..        ...                               ...    ...     ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity    0.0   298.0   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd    0.0   298.0   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online    0.0   291.0   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd    0.0     0.0   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India    0.0   215.0   5586.77\\n\\n[100 rows x 5 columns].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.26s =========================

2025-09-16 22:01:22,173 - WARNING - [FAILED] Attempt 2 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure PASSED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals =          Date                       Description  Debit  Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd    0.0   193.0   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd    0.0   165.0   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon    0.0   388.0   4631.11\n3  2024-08-03           Mobile Recharge Via UPI    0.0   164.0   6279.83\n4  2024-08-14          Fuel Purchase Debit Card    0.0   387.0  10158.40\n..        ...                               ...    ...     ...       ...\n95 2025-07-20  Utility Bill Payment Electricity    0.0   298.0   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd    0.0   298.0   6914.60\n97 2025-07-24      Electricity Bill NEFT Online    0.0   291.0   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd    0.0     0.0   3430.76\n99 2025-07-27         ATM Cash Withdrawal India    0.0   215.0   5586.77\n\n[100 rows x 5 columns].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (100, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\n        Date                Description  Debit  Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd    0.0   193.0   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd    0.0   165.0   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon    0.0   388.0   4631.11\n3 2024-08-03    Mobile Recharge Via UPI    0.0   164.0   6279.83\n4 2024-08-14   Fuel Purchase Debit Card    0.0   387.0  10158.40\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals =          Date                       Description  Debit  Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd    0.0   193.0   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd    0.0   165.0   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon    0.0   388.0   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI    0.0   164.0   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card    0.0   387.0  10158.40\\n..        ...                               ...    ...     ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity    0.0   298.0   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd    0.0   298.0   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online    0.0   291.0   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd    0.0     0.0   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India    0.0   215.0   5586.77\\n\\n[100 rows x 5 columns].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 1 failed, 6 passed in 2.26s =========================

2025-09-16 22:01:22,174 - INFO - [RETRY] Retrying with improved code...
2025-09-16 22:01:22,174 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 22:01:22,174 - INFO - [GENERATE] Generating parser code...
2025-09-16 22:01:28,841 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 22:01:28,842 - INFO - [TEST] Running tests...
2025-09-16 22:01:31,846 - ERROR - [FAIL] Tests failed!
2025-09-16 22:01:31,846 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 0 items / 1 error

=================================== ERRORS ====================================
_________________ ERROR collecting tests/test_icici_parser.py _________________
custom_parser\icici_parser.py:10: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:98: in open
    stream = open(path_or_fp, "rb")
             ^^^^^^^^^^^^^^^^^^^^^^
E   FileNotFoundError: [Errno 2] No such file or directory: 'data/icici/result.pdf'

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:20: in <module>
    from icici_parser import parse
custom_parser\icici_parser.py:53: in <module>
    result_df = parse(expected_csv_path.replace(".csv", ".pdf")) #replace .csv with .pdf for the actual parser
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:43: in parse
    raise FileNotFoundError(f"File not found: {pdf_path}")
E   FileNotFoundError: File not found: data/icici/result.pdf
=========================== short test summary info ===========================
ERROR tests/test_icici_parser.py - FileNotFoundError: File not found: data/ic...
!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
============================== 1 error in 1.18s ===============================

2025-09-16 22:01:31,846 - WARNING - [FAILED] Attempt 3 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 0 items / 1 error

=================================== ERRORS ====================================
_________________ ERROR collecting tests/test_icici_parser.py _________________
custom_parser\icici_parser.py:10: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:98: in open
    stream = open(path_or_fp, "rb")
             ^^^^^^^^^^^^^^^^^^^^^^
E   FileNotFoundError: [Errno 2] No such file or directory: 'data/icici/result.pdf'

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:20: in <module>
    from icici_parser import parse
custom_parser\icici_parser.py:53: in <module>
    result_df = parse(expected_csv_path.replace(".csv", ".pdf")) #replace .csv with .pdf for the actual parser
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:43: in parse
    raise FileNotFoundError(f"File not found: {pdf_path}")
E   FileNotFoundError: File not found: data/icici/result.pdf
=========================== short test summary info ===========================
ERROR tests/test_icici_parser.py - FileNotFoundError: File not found: data/ic...
!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
============================== 1 error in 1.18s ===============================

2025-09-16 22:01:31,846 - ERROR - [FAILED] Failed after 3 attempts
2025-09-16 22:01:31,846 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 22:05:28,041 - INFO - Initialized Gemini client
2025-09-16 22:05:28,041 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 22:05:28,387 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 22:05:28,388 - INFO - [GENERATE] Generating parser code...
2025-09-16 22:05:33,861 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 22:05:33,861 - INFO - [TEST] Running tests...
2025-09-16 22:05:37,604 - INFO - [PASS] All tests passed!
2025-09-16 22:05:37,604 - INFO - [SUCCESS] Parser generated and tested successfully in 1 attempt(s)
2025-09-16 22:05:37,605 - INFO - [COMPLETE] Agent completed successfully!
2025-09-16 22:06:15,607 - INFO - Initialized Gemini client
2025-09-16 22:06:15,607 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 22:06:15,939 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 22:06:15,939 - INFO - [GENERATE] Generating parser code...
2025-09-16 22:06:24,397 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 22:06:24,397 - INFO - [TEST] Running tests...
2025-09-16 22:06:28,259 - ERROR - [FAIL] Tests failed!
2025-09-16 22:06:28,259 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:73: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:46: in parse
    expected_df['Date'] = pd.to_datetime(expected_df['Date'])
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:583: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: time data "14-08-2024" doesn't match format "%m-%d-%Y", at position 4. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:81: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:46: in parse
    expected_df['Date'] = pd.to_datetime(expected_df['Date'])
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:583: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: time data "14-08-2024" doesn't match format "%m-%d-%Y", at position 4. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:95: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:46: in parse
    expected_df['Date'] = pd.to_datetime(expected_df['Date'])
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:583: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: time data "14-08-2024" doesn't match format "%m-%d-%Y", at position 4. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:109: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:46: in parse
    expected_df['Date'] = pd.to_datetime(expected_df['Date'])
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:583: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: time data "14-08-2024" doesn't match format "%m-%d-%Y", at position 4. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 2.21s =========================

2025-09-16 22:06:28,261 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:73: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:46: in parse
    expected_df['Date'] = pd.to_datetime(expected_df['Date'])
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:583: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: time data "14-08-2024" doesn't match format "%m-%d-%Y", at position 4. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:81: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:46: in parse
    expected_df['Date'] = pd.to_datetime(expected_df['Date'])
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:583: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: time data "14-08-2024" doesn't match format "%m-%d-%Y", at position 4. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:95: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:46: in parse
    expected_df['Date'] = pd.to_datetime(expected_df['Date'])
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:583: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: time data "14-08-2024" doesn't match format "%m-%d-%Y", at position 4. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:109: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:46: in parse
    expected_df['Date'] = pd.to_datetime(expected_df['Date'])
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:583: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: time data "14-08-2024" doesn't match format "%m-%d-%Y", at position 4. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 2.21s =========================

2025-09-16 22:06:28,263 - INFO - [RETRY] Retrying with improved code...
2025-09-16 22:06:28,263 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 22:06:28,263 - INFO - [GENERATE] Generating parser code...
2025-09-16 22:06:33,793 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 22:06:33,794 - INFO - [TEST] Running tests...
2025-09-16 22:06:37,484 - ERROR - [FAIL] Tests failed!
2025-09-16 22:06:37,484 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000001A77FBF1D00>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000001A77FBF1D00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 1.98s =========================

2025-09-16 22:06:37,484 - WARNING - [FAILED] Attempt 2 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000001A77FBF1D00>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000001A77FBF1D00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 1.98s =========================

2025-09-16 22:06:37,485 - INFO - [RETRY] Retrying with improved code...
2025-09-16 22:06:37,485 - INFO - [ATTEMPT] Attempt 3/3
2025-09-16 22:06:37,485 - INFO - [GENERATE] Generating parser code...
2025-09-16 22:06:42,699 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 22:06:42,701 - INFO - [TEST] Running tests...
2025-09-16 22:06:46,638 - ERROR - [FAIL] Tests failed!
2025-09-16 22:06:46,639 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:73: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.+)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")",line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 104
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:81: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.+)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")",line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 104
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:95: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.+)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")",line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 104
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:109: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.+)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")",line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 104
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - r...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 2.25s =========================

2025-09-16 22:06:46,640 - WARNING - [FAILED] Attempt 3 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:73: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.+)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")",line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 104
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:81: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.+)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")",line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 104
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:95: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.+)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")",line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 104
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:109: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:24: in parse
    match = re.match(date_pattern + r"\s*(?P<description>.+)\s*" + amount_pattern + r"\s*" + amount_pattern + r"\s*(?P<balance>" + amount_pattern + r")",line)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:167: in match
    return _compile(pattern, flags).match(string)
           ^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\__init__.py:307: in _compile
    p = _compiler.compile(pattern, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_compiler.py:745: in compile
    p = _parser.parse(p, flags)
        ^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:979: in parse
    p = _parse_sub(source, state, flags & SRE_FLAG_VERBOSE, 0)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:460: in _parse_sub
    itemsappend(_parse(source, state, verbose, nested + 1,
..\AppData\Local\Programs\Python\Python312\Lib\re\_parser.py:857: in _parse
    raise source.error(err.msg, len(name) + 1) from None
E   re.error: redefinition of group name 'amount' as group 4; was group 3 at position 104
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - r...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 2.25s =========================

2025-09-16 22:06:46,641 - ERROR - [FAILED] Failed after 3 attempts
2025-09-16 22:06:46,642 - ERROR - [FAILED] Agent failed to complete the task
2025-09-16 22:09:58,903 - INFO - Initialized Gemini client
2025-09-16 22:09:58,904 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 22:09:59,171 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 22:09:59,171 - INFO - [GENERATE] Generating parser code...
2025-09-16 22:10:13,389 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 22:10:13,389 - INFO - [TEST] Running tests...
2025-09-16 22:10:16,643 - ERROR - [FAIL] Tests failed!
2025-09-16 22:10:16,643 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000002789CD51D00>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000002789CD51D00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 1.75s =========================

2025-09-16 22:10:16,644 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x000002789CD51D00>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x000002789CD51D00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 3 failed, 4 passed in 1.75s =========================

2025-09-16 22:10:16,645 - INFO - [RETRY] Retrying with improved code...
2025-09-16 22:10:16,645 - INFO - [ATTEMPT] Attempt 2/3
2025-09-16 22:10:16,645 - INFO - [GENERATE] Generating parser code...
2025-09-16 22:15:10,206 - INFO - Initialized Gemini client
2025-09-16 22:15:10,206 - INFO - [START] Starting agent loop for ICICI bank
2025-09-16 22:15:10,473 - INFO - [ATTEMPT] Attempt 1/3
2025-09-16 22:15:10,474 - INFO - [GENERATE] Generating parser code...
2025-09-16 22:15:21,595 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-16 22:15:21,600 - INFO - [TEST] Running tests...
2025-09-16 22:15:24,731 - INFO - [PASS] All tests passed!
2025-09-16 22:15:24,731 - INFO - [SUCCESS] Parser generated and tested successfully in 1 attempt(s)
2025-09-16 22:15:24,731 - INFO - [COMPLETE] Agent completed successfully!
2025-09-17 00:18:34,917 - INFO - Initialized Gemini client
2025-09-17 00:18:34,921 - INFO - [START] Starting agent loop for ICICI bank
2025-09-17 00:18:35,307 - INFO - [ATTEMPT] Attempt 1/3
2025-09-17 00:18:35,307 - INFO - [GENERATE] Generating parser code...
2025-09-17 00:18:40,605 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-17 00:18:40,608 - INFO - [TEST] Running tests...
2025-09-17 00:18:44,124 - ERROR - [FAIL] Tests failed!
2025-09-17 00:18:44,125 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x0000016C44505D00>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x0000016C44505D00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:7: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:162: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:37: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 4 failed, 3 passed in 1.61s =========================

2025-09-17 00:18:44,126 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf FAILED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:102: in test_parse_data_types
    assert pd.api.types.is_numeric_dtype(result[col]), f"{col} column should be numeric type"
E   AssertionError: Debit column should be numeric type
E   assert False
E    +  where False = <function is_numeric_dtype at 0x0000016C44505D00>(Series([], Name: Debit, dtype: object))
E    +    where <function is_numeric_dtype at 0x0000016C44505D00> = <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'>.is_numeric_dtype
E    +      where <module 'pandas.api.types' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\types\\__init__.py'> = <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'>.types
E    +        where <module 'pandas.api' from 'C:\\Users\\Vaishnav A\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\pandas\\api\\__init__.py'> = pd.api
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                  object\nCredit                 object\nBalance                object\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
_______________ TestICICIParser.test_parse_handles_invalid_pdf ________________
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:50: in __init__
    self.doc = PDFDocument(PDFParser(stream), password=password or "")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfminer\pdfdocument.py:752: in __init__
    raise PDFSyntaxError("No /Root object! - Is this really a PDF?")
E   pdfminer.pdfparser.PDFSyntaxError: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
custom_parser\icici_parser.py:7: in parse
    with pdfplumber.open(pdf_path) as pdf:
         ^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:107: in open
    return cls(
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pdfplumber\pdf.py:52: in __init__
    raise PdfminerException(e)
E   pdfplumber.utils.exceptions.PdfminerException: No /Root object! - Is this really a PDF?

During handling of the above exception, another exception occurred:
tests\test_icici_parser.py:162: in test_parse_handles_invalid_pdf
    parse(str(dummy_file))
custom_parser\icici_parser.py:37: in parse
    except pdfplumber.pdf.EmptyFileError:
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'pdfplumber.pdf' has no attribute 'EmptyFileError'
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - A...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf
========================= 4 failed, 3 passed in 1.61s =========================

2025-09-17 00:18:44,126 - INFO - [RETRY] Retrying with improved code...
2025-09-17 00:18:44,127 - INFO - [ATTEMPT] Attempt 2/3
2025-09-17 00:18:44,127 - INFO - [GENERATE] Generating parser code...
2025-09-17 00:18:49,925 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-17 00:18:49,926 - INFO - [TEST] Running tests...
2025-09-17 00:18:53,892 - INFO - [PASS] All tests passed!
2025-09-17 00:18:53,892 - INFO - [SUCCESS] Parser generated and tested successfully in 2 attempt(s)
2025-09-17 00:18:53,892 - INFO - [COMPLETE] Agent completed successfully!
2025-09-17 00:19:35,028 - INFO - Initialized Gemini client
2025-09-17 00:19:35,029 - INFO - [START] Starting agent loop for ICICI bank
2025-09-17 00:19:35,381 - INFO - [ATTEMPT] Attempt 1/3
2025-09-17 00:19:35,381 - INFO - [GENERATE] Generating parser code...
2025-09-17 00:19:39,794 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-17 00:19:39,795 - INFO - [TEST] Running tests...
2025-09-17 00:19:43,665 - ERROR - [FAIL] Tests failed!
2025-09-17 00:19:43,665 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:73: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:42: in parse
    df['Date'] = pd.to_datetime(df['Date'], format='%d-%m-%Y')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:587: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: unconverted data remains when parsing with format "%d-%m-%Y": "-Salary-Credit", at position 0. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:81: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:42: in parse
    df['Date'] = pd.to_datetime(df['Date'], format='%d-%m-%Y')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:587: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: unconverted data remains when parsing with format "%d-%m-%Y": "-Salary-Credit", at position 0. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:95: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:42: in parse
    df['Date'] = pd.to_datetime(df['Date'], format='%d-%m-%Y')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:587: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: unconverted data remains when parsing with format "%d-%m-%Y": "-Salary-Credit", at position 0. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:109: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:42: in parse
    df['Date'] = pd.to_datetime(df['Date'], format='%d-%m-%Y')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:587: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: unconverted data remains when parsing with format "%d-%m-%Y": "-Salary-Credit", at position 0. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 2.09s =========================

2025-09-17 00:19:43,666 - WARNING - [FAILED] Attempt 1 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe FAILED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types FAILED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
________________ TestICICIParser.test_parse_returns_dataframe _________________
tests\test_icici_parser.py:73: in test_parse_returns_dataframe
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:42: in parse
    df['Date'] = pd.to_datetime(df['Date'], format='%d-%m-%Y')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:587: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: unconverted data remains when parsing with format "%d-%m-%Y": "-Salary-Credit", at position 0. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:81: in test_parse_dataframe_structure
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:42: in parse
    df['Date'] = pd.to_datetime(df['Date'], format='%d-%m-%Y')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:587: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: unconverted data remains when parsing with format "%d-%m-%Y": "-Salary-Credit", at position 0. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
____________________ TestICICIParser.test_parse_data_types ____________________
tests\test_icici_parser.py:95: in test_parse_data_types
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:42: in parse
    df['Date'] = pd.to_datetime(df['Date'], format='%d-%m-%Y')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:587: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: unconverted data remains when parsing with format "%d-%m-%Y": "-Salary-Credit", at position 0. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:109: in test_parse_matches_expected_data
    result = parse(sample_pdf_path)
             ^^^^^^^^^^^^^^^^^^^^^^
custom_parser\icici_parser.py:42: in parse
    df['Date'] = pd.to_datetime(df['Date'], format='%d-%m-%Y')
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:1067: in to_datetime
    values = convert_listlike(arg._values, format)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:433: in _convert_listlike_datetimes
    return _array_strptime_with_fallback(arg, name, utc, format, exact, errors)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pandas\core\tools\datetimes.py:467: in _array_strptime_with_fallback
    result, tz_out = array_strptime(arg, fmt, exact=exact, errors=errors, utc=utc)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
strptime.pyx:501: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:451: in pandas._libs.tslibs.strptime.array_strptime
    ???
strptime.pyx:587: in pandas._libs.tslibs.strptime._parse_with_format
    ???
E   ValueError: unconverted data remains when parsing with format "%d-%m-%Y": "-Salary-Credit", at position 0. You might want to try:
E       - passing `format` if your strings have a consistent format;
E       - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
E       - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this.
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_data_types - V...
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 4 failed, 3 passed in 2.09s =========================

2025-09-17 00:19:43,668 - INFO - [RETRY] Retrying with improved code...
2025-09-17 00:19:43,668 - INFO - [ATTEMPT] Attempt 2/3
2025-09-17 00:19:43,668 - INFO - [GENERATE] Generating parser code...
2025-09-17 00:19:44,094 - ERROR - Error generating parser code: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 16
}
]
2025-09-17 00:19:44,094 - ERROR - [ERROR] Error in attempt 2: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 16
}
]
2025-09-17 00:19:44,095 - INFO - [RETRY] Retrying...
2025-09-17 00:19:44,095 - INFO - [ATTEMPT] Attempt 3/3
2025-09-17 00:19:44,095 - INFO - [GENERATE] Generating parser code...
2025-09-17 00:19:51,160 - INFO - Saved parser code to custom_parser\icici_parser.py
2025-09-17 00:19:51,161 - INFO - [TEST] Running tests...
2025-09-17 00:19:54,974 - ERROR - [FAIL] Tests failed!
2025-09-17 00:19:54,975 - ERROR - Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                   int64\nCredit                  int64\nBalance                 int64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 2 failed, 5 passed in 1.99s =========================

2025-09-17 00:19:54,975 - WARNING - [FAILED] Attempt 3 failed. Test output:
============================= test session starts =============================
platform win32 -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\Vaishnav A\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\Vaishnav A\ai-agent-challenge
plugins: anyio-4.8.0, langsmith-0.3.19
collecting ... collected 7 items

tests/test_icici_parser.py::TestICICIParser::test_parse_file_exists PASSED [ 14%]
tests/test_icici_parser.py::TestICICIParser::test_parse_returns_dataframe PASSED [ 28%]
tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure FAILED [ 42%]
tests/test_icici_parser.py::TestICICIParser::test_parse_data_types PASSED [ 57%]
tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data FAILED [ 71%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_missing_file PASSED [ 85%]
tests/test_icici_parser.py::TestICICIParser::test_parse_handles_invalid_pdf PASSED [100%]

================================== FAILURES ===================================
_______________ TestICICIParser.test_parse_dataframe_structure ________________
tests\test_icici_parser.py:88: in test_parse_dataframe_structure
    assert len(result) > 0, "DataFrame should not be empty"
E   AssertionError: DataFrame should not be empty
E   assert 0 > 0
E    +  where 0 = len(Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [])
______________ TestICICIParser.test_parse_matches_expected_data _______________
tests\test_icici_parser.py:143: in test_parse_matches_expected_data
    assert result_sorted.equals(expected_sorted), \
E   AssertionError: DataFrames are not equal according to pandas DataFrame.equals()
E   assert False
E    +  where False = equals(         Date                       Description    Debit   Credit   Balance\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\n..        ...                               ...      ...      ...       ...\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\n\n[100 rows x 5 columns])
E    +    where equals = Empty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: [].equals
---------------------------- Captured stdout call -----------------------------
\u274c DataFrame.equals() returned False\nResult DataFrame shape: (0, 5)\nExpected DataFrame shape: (100, 5)\nResult dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                   int64\nCredit                  int64\nBalance                 int64\ndtype: object\nExpected dtypes:\nDate           datetime64[ns]\nDescription            object\nDebit                 float64\nCredit                float64\nBalance               float64\ndtype: object\n\nFirst 5 rows of result:\nEmpty DataFrame\nColumns: [Date, Description, Debit, Credit, Balance]\nIndex: []\n\nFirst 5 rows of expected:\n        Date                Description    Debit   Credit   Balance\n0 2024-08-01  Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\n1 2024-08-02  Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\n2 2024-08-03    IMPS UPI Payment Amazon  3886.08     0.00   4631.11\n3 2024-08-03    Mobile Recharge Via UPI     0.00  1648.72   6279.83\n4 2024-08-14   Fuel Purchase Debit Card     0.00  3878.57  10158.40\n\u274c Error during comparison: DataFrames are not equal according to pandas DataFrame.equals()\nassert False\n +  where False = equals(         Date                       Description    Debit   Credit   Balance\\n0  2024-08-01         Salary Credit XYZ Pvt Ltd  1935.30     0.00   6864.58\\n1  2024-08-02         Salary Credit XYZ Pvt Ltd     0.00  1652.61   8517.19\\n2  2024-08-03           IMPS UPI Payment Amazon  3886.08     0.00   4631.11\\n3  2024-08-03           Mobile Recharge Via UPI     0.00  1648.72   6279.83\\n4  2024-08-14          Fuel Purchase Debit Card     0.00  3878.57  10158.40\\n..        ...                               ...      ...      ...       ...\\n95 2025-07-20  Utility Bill Payment Electricity     0.00  2989.23   3926.14\\n96 2025-07-23         Salary Credit XYZ Pvt Ltd     0.00  2988.46   6914.60\\n97 2025-07-24      Electricity Bill NEFT Online  2917.52     0.00   3997.08\\n98 2025-07-25         Salary Credit XYZ Pvt Ltd   566.32     0.00   3430.76\\n99 2025-07-27         ATM Cash Withdrawal India     0.00  2156.01   5586.77\\n\\n[100 rows x 5 columns])\n +    where equals = Empty DataFrame\\nColumns: [Date, Description, Debit, Credit, Balance]\\nIndex: [].equals
=========================== short test summary info ===========================
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_dataframe_structure
FAILED tests/test_icici_parser.py::TestICICIParser::test_parse_matches_expected_data
========================= 2 failed, 5 passed in 1.99s =========================

2025-09-17 00:19:54,976 - ERROR - [FAILED] Failed after 3 attempts
2025-09-17 00:19:54,977 - ERROR - [FAILED] Agent failed to complete the task
2025-09-17 00:23:53,271 - INFO - Initialized Gemini client
2025-09-17 00:23:53,271 - INFO - [START] Starting agent loop for ICICI bank
2025-09-17 00:23:53,646 - INFO - [ATTEMPT] Attempt 1/3
2025-09-17 00:23:53,646 - INFO - [GENERATE] Generating parser code...
2025-09-17 00:23:55,531 - ERROR - Error generating parser code: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 4
}
]
2025-09-17 00:23:55,532 - ERROR - [ERROR] Error in attempt 1: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 4
}
]
2025-09-17 00:23:55,532 - INFO - [RETRY] Retrying...
2025-09-17 00:23:55,533 - INFO - [ATTEMPT] Attempt 2/3
2025-09-17 00:23:55,533 - INFO - [GENERATE] Generating parser code...
2025-09-17 00:23:55,949 - ERROR - Error generating parser code: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 4
}
]
2025-09-17 00:23:55,949 - ERROR - [ERROR] Error in attempt 2: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 4
}
]
2025-09-17 00:23:55,950 - INFO - [RETRY] Retrying...
2025-09-17 00:23:55,951 - INFO - [ATTEMPT] Attempt 3/3
2025-09-17 00:23:55,951 - INFO - [GENERATE] Generating parser code...
2025-09-17 00:23:57,195 - ERROR - Error generating parser code: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 3
}
]
2025-09-17 00:23:57,196 - ERROR - [ERROR] Error in attempt 3: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [violations {
  quota_metric: "generativelanguage.googleapis.com/generate_content_free_tier_requests"
  quota_id: "GenerateRequestsPerDayPerProjectPerModel-FreeTier"
  quota_dimensions {
    key: "model"
    value: "gemini-1.5-flash"
  }
  quota_dimensions {
    key: "location"
    value: "global"
  }
  quota_value: 50
}
, links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, retry_delay {
  seconds: 3
}
]
2025-09-17 00:23:57,196 - ERROR - [FAILED] Failed after 3 attempts due to errors
2025-09-17 00:23:57,197 - ERROR - [FAILED] Agent failed to complete the task
2025-09-17 09:53:01,639 - INFO - Initialized Gemini client
2025-09-17 09:53:01,640 - INFO - [START] Starting agent loop for ICICI bank
2025-09-17 09:53:01,641 - INFO - [CHECK] Existing parser found, testing...
2025-09-17 09:53:04,236 - INFO - [PASS] All tests passed!
2025-09-17 09:53:04,236 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-17 09:53:04,236 - INFO - [COMPLETE] Agent completed successfully!
2025-09-17 09:53:13,306 - INFO - Initialized Gemini client
2025-09-17 09:53:13,307 - INFO - [START] Starting agent loop for ICICI bank
2025-09-17 09:53:13,307 - INFO - [CHECK] Existing parser found, testing...
2025-09-17 09:53:15,650 - INFO - [PASS] All tests passed!
2025-09-17 09:53:15,651 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-17 09:53:15,651 - INFO - [COMPLETE] Agent completed successfully!
2025-09-17 09:53:39,023 - INFO - Initialized Gemini client
2025-09-17 09:53:39,023 - INFO - [START] Starting agent loop for ICICI bank
2025-09-17 09:53:39,024 - INFO - [CHECK] Existing parser found, testing...
2025-09-17 09:53:41,543 - INFO - [PASS] All tests passed!
2025-09-17 09:53:41,544 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-17 09:53:41,544 - INFO - [COMPLETE] Agent completed successfully!
2025-09-17 09:55:49,285 - INFO - Initialized Gemini client
2025-09-17 09:55:49,285 - INFO - [START] Starting agent loop for ICICI bank
2025-09-17 09:55:49,286 - INFO - [CHECK] Existing parser found, testing...
2025-09-17 09:55:51,783 - INFO - [PASS] All tests passed!
2025-09-17 09:55:51,783 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-17 09:55:51,783 - INFO - [COMPLETE] Agent completed successfully!
2025-09-17 09:55:59,946 - INFO - Initialized Gemini client
2025-09-17 09:55:59,947 - INFO - [START] Starting agent loop for ICICI bank
2025-09-17 09:55:59,947 - INFO - [CHECK] Existing parser found, testing...
2025-09-17 09:56:02,364 - INFO - [PASS] All tests passed!
2025-09-17 09:56:02,364 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-17 09:56:02,364 - INFO - [COMPLETE] Agent completed successfully!
2025-09-17 09:56:23,909 - INFO - Initialized Gemini client
2025-09-17 09:56:23,909 - INFO - [START] Starting agent loop for ICICI bank
2025-09-17 09:56:23,909 - INFO - [CHECK] Existing parser found, testing...
2025-09-17 09:56:26,399 - INFO - [PASS] All tests passed!
2025-09-17 09:56:26,400 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-17 09:56:26,401 - INFO - [COMPLETE] Agent completed successfully!
2025-09-17 09:58:18,846 - INFO - Initialized Gemini client
2025-09-17 09:58:18,848 - INFO - [START] Starting agent loop for ICICI bank
2025-09-17 09:58:18,848 - INFO - [CHECK] Existing parser found, testing...
2025-09-17 09:58:20,902 - INFO - [PASS] All tests passed!
2025-09-17 09:58:20,902 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-17 09:58:20,902 - INFO - [COMPLETE] Agent completed successfully!
2025-09-17 09:59:09,832 - INFO - Initialized Gemini client
2025-09-17 09:59:09,833 - INFO - [START] Starting agent loop for ICICI bank
2025-09-17 09:59:09,833 - INFO - [CHECK] Existing parser found, testing...
2025-09-17 09:59:12,267 - INFO - [PASS] All tests passed!
2025-09-17 09:59:12,267 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-17 09:59:12,268 - INFO - [COMPLETE] Agent completed successfully!
2025-09-28 07:48:04,825 - INFO - Initialized Gemini client
2025-09-28 07:48:04,826 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 07:48:04,826 - INFO - [CHECK] Existing parser found, testing...
2025-09-28 07:48:07,225 - INFO - [PASS] All tests passed!
2025-09-28 07:48:07,225 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-28 07:48:07,225 - INFO - [COMPLETE] Agent completed successfully!
2025-09-28 07:50:38,298 - INFO - Initialized gemini client
2025-09-28 07:50:38,298 - INFO - [START] Agent loop for ICICI
2025-09-28 07:50:38,298 - INFO - [CHECK] Testing existing parser...
2025-09-28 07:50:40,886 - INFO - [PASS] Tests passed!
2025-09-28 07:50:40,886 - INFO - [SUCCESS] Existing parser works!
2025-09-28 07:53:03,249 - INFO - Initialized Gemini client
2025-09-28 07:53:03,251 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 07:53:03,251 - INFO - [CHECK] Existing parser found, testing...
2025-09-28 07:53:05,637 - INFO - [PASS] All tests passed!
2025-09-28 07:53:05,637 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-28 07:53:05,637 - INFO - [COMPLETE] Agent completed successfully!
2025-09-28 07:53:45,215 - INFO - Initialized Gemini client
2025-09-28 07:53:45,215 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 07:53:45,215 - INFO - [CHECK] Existing parser found, testing...
2025-09-28 07:53:47,768 - INFO - [PASS] All tests passed!
2025-09-28 07:53:47,768 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-28 07:53:47,768 - INFO - [COMPLETE] Agent completed successfully!
2025-09-28 07:58:13,216 - INFO - Initialized Gemini client
2025-09-28 07:58:13,216 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 07:58:13,216 - INFO - [CHECK] Existing parser found, testing...
2025-09-28 07:58:15,407 - INFO - [PASS] All tests passed!
2025-09-28 07:58:15,407 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-28 07:58:15,407 - INFO - [COMPLETE] Agent completed successfully!
2025-09-28 08:04:52,691 - INFO - Initialized Gemini client
2025-09-28 08:04:52,692 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 08:04:52,692 - INFO - [CHECK] Existing parser found, testing...
2025-09-28 08:04:54,978 - INFO - [PASS] All tests passed!
2025-09-28 08:04:54,978 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-28 08:04:54,978 - INFO - [COMPLETE] Agent completed successfully!
2025-09-28 08:05:20,751 - INFO - Initialized Gemini client
2025-09-28 08:05:20,753 - INFO - [START] Starting agent loop for HDFC bank
2025-09-28 08:05:20,754 - ERROR - Sample CSV not found: data\hdfc\result.csv
2025-09-28 08:05:20,754 - ERROR - [FAILED] Agent failed to complete the task
2025-09-28 09:41:04,515 - INFO - Initialized Gemini client
2025-09-28 09:41:04,516 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 09:41:04,765 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 09:41:04,766 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:43:53,340 - INFO - Initialized Gemini client
2025-09-28 09:43:53,341 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 09:43:53,753 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 09:43:53,753 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:43:54,856 - INFO - Initialized Gemini client
2025-09-28 09:43:54,857 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 09:43:55,234 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 09:43:55,234 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:43:55,280 - INFO - Initialized Gemini client
2025-09-28 09:43:55,280 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 09:43:55,616 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 09:43:55,616 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:43:55,646 - INFO - Initialized Gemini client
2025-09-28 09:43:55,646 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 09:43:55,921 - INFO - Initialized Gemini client
2025-09-28 09:43:55,921 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 09:43:55,951 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 09:43:55,951 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:43:56,193 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 09:43:56,193 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:44:00,148 - ERROR - Error generating parser code: 404 models/gemini-1.5-flash is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2025-09-28 09:44:00,148 - ERROR - [ERROR] Error in attempt 1: 404 models/gemini-1.5-flash is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2025-09-28 09:44:00,148 - INFO - [RETRY] Retrying...
2025-09-28 09:44:00,150 - INFO - [ATTEMPT] Attempt 2/3
2025-09-28 09:44:00,150 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:44:04,256 - INFO - Initialized Gemini client
2025-09-28 09:44:04,256 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 09:44:04,760 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 09:44:04,760 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:44:06,115 - INFO - Initialized Gemini client
2025-09-28 09:44:06,116 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 09:44:06,510 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 09:44:06,510 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:44:06,689 - INFO - Initialized Gemini client
2025-09-28 09:44:06,689 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 09:44:07,060 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 09:44:07,060 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:44:07,153 - INFO - Initialized Gemini client
2025-09-28 09:44:07,154 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 09:44:07,381 - INFO - Initialized Gemini client
2025-09-28 09:44:07,382 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 09:44:07,490 - INFO - Initialized Gemini client
2025-09-28 09:44:07,491 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 09:44:07,507 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 09:44:07,507 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:44:07,706 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 09:44:07,707 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:44:07,801 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 09:44:07,801 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:44:08,112 - ERROR - Error generating parser code: 404 models/gemini-1.5-flash is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2025-09-28 09:44:08,113 - ERROR - [ERROR] Error in attempt 2: 404 models/gemini-1.5-flash is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2025-09-28 09:44:08,113 - INFO - [RETRY] Retrying...
2025-09-28 09:44:08,114 - INFO - [ATTEMPT] Attempt 3/3
2025-09-28 09:44:08,114 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:44:14,107 - INFO - Initialized Gemini client
2025-09-28 09:44:14,108 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 09:44:14,378 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 09:44:14,378 - INFO - [GENERATE] Generating parser code...
2025-09-28 09:44:21,080 - ERROR - Error generating parser code: 404 models/gemini-1.5-flash is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2025-09-28 09:44:21,081 - ERROR - [ERROR] Error in attempt 3: 404 models/gemini-1.5-flash is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2025-09-28 09:44:21,081 - ERROR - [FAILED] Failed after 3 attempts due to errors
2025-09-28 09:44:21,081 - ERROR - [FAILED] Agent failed to complete the task
2025-09-28 09:44:39,777 - INFO - Initialized Gemini client
2025-09-28 09:44:39,777 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 09:44:40,030 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 09:44:40,030 - INFO - [GENERATE] Generating parser code...
2025-09-28 10:21:33,384 - INFO - Initialized Gemini client
2025-09-28 10:21:33,385 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 10:21:33,387 - INFO - [CHECK] Existing parser found, testing...
2025-09-28 10:21:35,508 - INFO - [PASS] All tests passed!
2025-09-28 10:21:35,508 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-28 10:21:35,508 - INFO - [COMPLETE] Agent completed successfully!
2025-09-28 10:22:09,145 - INFO - Initialized Gemini client
2025-09-28 10:22:09,145 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 10:22:09,471 - INFO - [ATTEMPT] Attempt 1/3
2025-09-28 10:22:09,472 - INFO - [GENERATE] Generating parser code...
2025-09-28 10:22:10,648 - ERROR - Error generating parser code: 404 models/gemini-1.5-flash is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2025-09-28 10:22:10,648 - ERROR - [ERROR] Error in attempt 1: 404 models/gemini-1.5-flash is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2025-09-28 10:22:10,649 - INFO - [RETRY] Retrying...
2025-09-28 10:22:10,649 - INFO - [ATTEMPT] Attempt 2/3
2025-09-28 10:22:10,649 - INFO - [GENERATE] Generating parser code...
2025-09-28 10:22:10,955 - ERROR - Error generating parser code: 404 models/gemini-1.5-flash is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2025-09-28 10:22:10,955 - ERROR - [ERROR] Error in attempt 2: 404 models/gemini-1.5-flash is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2025-09-28 10:22:10,955 - INFO - [RETRY] Retrying...
2025-09-28 10:22:10,955 - INFO - [ATTEMPT] Attempt 3/3
2025-09-28 10:22:10,956 - INFO - [GENERATE] Generating parser code...
2025-09-28 10:22:12,493 - ERROR - Error generating parser code: 404 models/gemini-1.5-flash is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2025-09-28 10:22:12,494 - ERROR - [ERROR] Error in attempt 3: 404 models/gemini-1.5-flash is not found for API version v1beta, or is not supported for generateContent. Call ListModels to see the list of available models and their supported methods.
2025-09-28 10:22:12,494 - ERROR - [FAILED] Failed after 3 attempts due to errors
2025-09-28 10:22:12,495 - ERROR - [FAILED] Agent failed to complete the task
2025-09-28 10:24:04,290 - INFO - Initialized Gemini client
2025-09-28 10:24:04,290 - INFO - [START] Starting agent loop for ICICI bank
2025-09-28 10:24:04,290 - INFO - [CHECK] Existing parser found, testing...
2025-09-28 10:24:06,408 - INFO - [PASS] All tests passed!
2025-09-28 10:24:06,408 - INFO - [SUCCESS] Existing parser is working correctly!
2025-09-28 10:24:06,408 - INFO - [COMPLETE] Agent completed successfully!
2025-09-28 10:35:53,060 - INFO - Initialized gemini client
2025-09-28 10:35:53,060 - INFO - [START] Agent loop for ICICI
2025-09-28 10:35:53,061 - INFO - [CHECK] Testing existing parser...
2025-09-28 10:35:55,044 - INFO - [PASS] Tests passed!
2025-09-28 10:35:55,044 - INFO - [SUCCESS] Existing parser works!
2025-09-28 10:36:12,440 - INFO - Initialized gemini client
2025-09-28 10:36:12,441 - INFO - [START] Agent loop for ICICI
2025-09-28 10:36:12,441 - INFO - [CHECK] Testing existing parser...
2025-09-28 10:36:14,413 - INFO - [PASS] Tests passed!
2025-09-28 10:36:14,413 - INFO - [SUCCESS] Existing parser works!
2025-09-28 10:43:46,544 - INFO - Initialized gemini client
2025-09-28 10:43:46,545 - INFO - [START] Agent loop for ICICI
2025-09-28 10:43:46,545 - INFO - [CHECK] Testing existing parser...
2025-09-28 10:43:48,584 - INFO - [PASS] Tests passed!
2025-09-28 10:43:48,584 - INFO - [SUCCESS] Existing parser works!
2025-09-28 10:44:06,876 - INFO - Initialized gemini client
2025-09-28 10:44:06,877 - INFO - [START] Agent loop for ICICI
2025-09-28 10:44:06,877 - INFO - [CHECK] Testing existing parser...
2025-09-28 10:44:08,896 - INFO - [PASS] Tests passed!
2025-09-28 10:44:08,896 - INFO - [SUCCESS] Existing parser works!
2025-09-28 10:44:11,432 - INFO - Initialized gemini client
2025-09-28 10:44:11,433 - INFO - [START] Agent loop for ICICI
2025-09-28 10:44:11,433 - INFO - [CHECK] Testing existing parser...
2025-09-28 10:44:13,523 - INFO - [PASS] Tests passed!
2025-09-28 10:44:13,523 - INFO - [SUCCESS] Existing parser works!
2025-09-28 10:44:32,311 - INFO - Initialized gemini client
2025-09-28 10:44:32,311 - INFO - [START] Agent loop for ICICI
2025-09-28 10:44:32,312 - INFO - [CHECK] Testing existing parser...
2025-09-28 10:44:34,964 - INFO - [PASS] Tests passed!
2025-09-28 10:44:34,964 - INFO - [SUCCESS] Existing parser works!
2025-09-28 10:44:36,061 - INFO - Initialized gemini client
2025-09-28 10:44:36,061 - INFO - [START] Agent loop for ICICI
2025-09-28 10:44:36,062 - INFO - [CHECK] Testing existing parser...
2025-09-28 10:44:36,099 - INFO - Initialized gemini client
2025-09-28 10:44:36,100 - INFO - [START] Agent loop for ICICI
2025-09-28 10:44:36,100 - INFO - [CHECK] Testing existing parser...
2025-09-28 10:44:38,509 - INFO - [PASS] Tests passed!
2025-09-28 10:44:38,510 - INFO - [SUCCESS] Existing parser works!
2025-09-28 10:44:38,510 - INFO - [SUCCESS] Existing parser works!
2025-09-28 10:45:02,540 - INFO - Initialized gemini client
2025-09-28 10:45:02,540 - INFO - [START] Agent loop for ICICI
2025-09-28 10:45:02,541 - INFO - [CHECK] Testing existing parser...
2025-09-28 10:45:04,597 - INFO - [PASS] Tests passed!
2025-09-28 10:45:04,598 - INFO - [SUCCESS] Existing parser works!
2025-09-28 10:47:11,156 - INFO - Initialized gemini client
2025-09-28 10:47:11,156 - INFO - [START] Agent loop for ICICI
2025-09-28 10:47:11,157 - INFO - [CHECK] Testing existing parser...
2025-09-28 10:47:13,113 - INFO - [PASS] Tests passed!
2025-09-28 10:47:13,114 - INFO - [SUCCESS] Existing parser works!
2025-09-28 10:52:05,627 - INFO - Initialized gemini client
2025-09-28 10:52:05,628 - INFO - [START] Agent loop for ICICI
2025-09-28 10:52:05,628 - INFO - [CHECK] Testing existing parser...
2025-09-28 10:52:07,855 - INFO - [PASS] Tests passed!
2025-09-28 10:52:07,856 - INFO - [SUCCESS] Existing parser works!
2025-09-28 11:06:45,089 - INFO - Initialized gemini client
2025-09-28 11:06:45,090 - INFO - [START] Agent loop for ICICI
2025-09-28 11:06:45,090 - INFO - [CHECK] Testing existing parser...
2025-09-28 11:06:47,451 - INFO - [PASS] Tests passed!
2025-09-28 11:06:47,451 - INFO - [SUCCESS] Existing parser works!
